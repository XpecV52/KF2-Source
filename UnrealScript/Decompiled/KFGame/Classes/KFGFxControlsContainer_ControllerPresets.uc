/*******************************************************************************
 * KFGFxControlsContainer_ControllerPresets generated by Eliot.UELib using UE Explorer.
 * Eliot.UELib ? 2009-2022 Eliot van Uytfanghe. All rights reserved.
 * http://eliotvu.com
 *
 * All rights belong to their respective owners.
 *******************************************************************************/
class KFGFxControlsContainer_ControllerPresets extends KFGFxObject_Container within GFxMoviePlayer;

struct KeyBinding
{
    var string Key;
    var string Command;
    var string HoldCommand;

    structdefaultproperties
    {
        Key=""
        Command=""
        HoldCommand=""
    }
};

var const string InputSectionName;
var const string PackageName;
var const localized string MovementString;
var const localized string LookString;
var const localized string ShowScoardBoardString;
var const localized string ShowIngameMenuString;
var const localized string HoldString;
var const localized string CurrentControllerPresetString;
var int numGamepadLayouts;
var byte CurrentLocalizedIndex;
var byte CurrentPresetIndex;

function Initialize(KFGFxObject_Menu NewParentMenu)
{
    super.Initialize(NewParentMenu);
    CurrentPresetIndex = byte(KFPlayerInput(Outer.GetPC().PlayerInput).CurrentLayoutIndex);
    UpdateCurrentPresetArray(CurrentPresetIndex);
}

function UpdateCurrentPresetArray(byte PresetIndex)
{
    local KFPlayerInput KFPlayerInput, KFPI;

    CurrentPresetIndex = PresetIndex;
    numGamepadLayouts = Class'KFGamepadLayoutManager'.static.GetNumLayouts();
    if(CurrentPresetIndex >= numGamepadLayouts)
    {
        CurrentPresetIndex = 0;        
    }
    else
    {
        if(CurrentPresetIndex < 0)
        {
            CurrentPresetIndex = byte(numGamepadLayouts - 1);
        }
    }
    KFPlayerInput = KFPlayerInput(Outer.GetPC().PlayerInput);
    KFPlayerInput.SetGamepadLayout(CurrentPresetIndex);
    LocalizeText();
    UpdateButtonDescriptions();
    KFPI = KFPlayerInput(Outer.GetPC().PlayerInput);
    KFPI.CurrentLayoutIndex = CurrentPresetIndex;
    KFPI.SaveConfig();
}

function LocalizeText()
{
    local GFxObject TextField, PresetArray, StepperOption;
    local int I;

    TextField = GetObject("CurrentPresetTextfield");
    PresetArray = Outer.CreateArray();
    I = 0;
    J0x61:

    if(I < numGamepadLayouts)
    {
        StepperOption = Outer.CreateObject("Object");
        StepperOption.SetString("label", string(I));
        PresetArray.SetElementObject(I, StepperOption);
        ++ I;
        goto J0x61;
    }
    SetObject("presetOptions", PresetArray);
    SetInt("currentPreset", CurrentPresetIndex);
    if(TextField != none)
    {
        TextField.SetText(CurrentControllerPresetString);
    }
}

function UpdateButtonDescriptions()
{
    local GFxObject LocalizedObject;
    local name GamepadButtonNames[20];
    local KFPlayerInput KFPlayerInput;
    local byte I;
    local string bindCommand;
    local GFxObject TempTextField;
    local string TextFieldName, localizedCommand;

    CurrentLocalizedIndex = 0;
    LocalizedObject = Outer.CreateObject("Object");
    LocalizedObject.SetString("leftThumbstick", MovementString);
    LocalizedObject.SetString("rightThumbstick", LookString);
    LocalizedObject.SetString("back", ShowScoardBoardString);
    LocalizedObject.SetString("start", ShowIngameMenuString);
    KFPlayerInput = KFPlayerInput(Outer.GetPC().PlayerInput);
    Class'KFGamepadLayoutManager'.static.GetGamepadButtonNames(GamepadButtonNames);
    I = 0;
    J0x18C:

    if(I < 20)
    {
        TextFieldName = string(GamepadButtonNames[I]) $ "Textfield";
        TempTextField = GetObject(TextFieldName);
        if(TempTextField != none)
        {
            bindCommand = KFPlayerInput.GetGameBindableAction(GamepadButtonNames[I]);
            localizedCommand = Localize(InputSectionName, bindCommand, PackageName);
            TempTextField.SetText(localizedCommand);
        }
        ++ I;
        goto J0x18C;
    }
}

function AddBindingToGFxObject(out GFxObject ObjectArray, string Key, string Command, string HoldCommand, byte I)
{
    local GFxObject TempObject;
    local string CommandString, HoldCommandString;

    TempObject = Outer.CreateObject("Object");
    CommandString = Localize(InputSectionName, Command, PackageName);
    if(HoldCommand != "")
    {
        HoldCommandString = Localize(InputSectionName, HoldCommand, PackageName);        
        HoldCommandString -= HoldString;
        CommandString = ((CommandString $ "
") $ HoldCommandString) @ HoldString;
    }
    TempObject.SetString("Key", Key);
    TempObject.SetString("Command", CommandString);
    ObjectArray.SetElementObject(I, TempObject);
}

defaultproperties
{
    InputSectionName="LocalizedControls"
    PackageName="KFGame"
    MovementString="Movement Control"
    LookString="Look Control"
    ShowScoardBoardString="Show Scoreboard"
    ShowIngameMenuString="Toggle In Game Menu"
    HoldString="(Hold)"
    CurrentControllerPresetString="Current Controller Preset"
}