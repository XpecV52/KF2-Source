/*******************************************************************************
 * KFGFxMissionObjectivesContainer generated by Eliot.UELib using UE Explorer.
 * Eliot.UELib ? 2009-2022 Eliot van Uytfanghe. All rights reserved.
 * http://eliotvu.com
 *
 * All rights belong to their respective owners.
 *******************************************************************************/
class KFGFxMissionObjectivesContainer extends KFGFxObject_Container within GFxMoviePlayer;

var KFGFxCollapsedObjectivesContainer CollapsedObjectiveContainer;
var KFGFxExpandedObjectivesContainer ExpandedObjectiveContainer;
var bool bInitialAutoExpandCheckComplete;
var bool bLastShowSpecialEvent;
var bool bLastShowWeekly;

function Initialize(KFGFxObject_Menu NewParentMenu)
{
    super.Initialize(NewParentMenu);
    Outer.GetPC().SetTimer(0.25, true, 'UpdateMissionObjectiveState', self);
}

function UpdateMissionObjectiveState()
{
    local KFPlayerController KFPC;
    local bool bShouldShow, bShouldExpand;
    local int TargetPage;
    local bool bShowWeekly, bShowSpecialEvent;

    KFPC = KFPlayerController(Outer.GetPC());
    bShouldExpand = false;
    TargetPage = -1;
    bShouldShow = false;
    bShowWeekly = ((KFPC != none) && KFPC.IsA('KFPlayerController_WeeklySurvival')) || Class'WorldInfo'.static.IsMenuLevel();
    bShowSpecialEvent = ShowShouldSpecialEvent();
    if(!bInitialAutoExpandCheckComplete || bShowWeekly != bLastShowWeekly)
    {
        if(bShowWeekly)
        {
            bShouldExpand = true;
            TargetPage = 0;
            bShouldShow = true;
            SetBool("expanded", true);
            ExpandedObjectiveContainer.SetInt("pageIndex", 0);            
        }
        else
        {
            UpdateWeeklyUIActive(false);
        }
        bLastShowWeekly = bShowWeekly;
    }
    if((bShowSpecialEvent != bLastShowSpecialEvent) || !bInitialAutoExpandCheckComplete)
    {
        if(bShowSpecialEvent)
        {
            bShouldExpand = true;
            TargetPage = 1;
            bShouldShow = true;
            ExpandedObjectiveContainer.SetInt("pageIndex", TargetPage);
        }
        bLastShowSpecialEvent = bShowSpecialEvent;
        UpdateSpecialEventActive();
    }
    if(Class'WorldInfo'.static.IsMenuLevel())
    {
        bShouldShow = true;
        bShouldExpand = false;
    }
    if(!bInitialAutoExpandCheckComplete)
    {
        SetVisible(bShouldShow);
        SetBool("expanded", bShouldExpand);
        SetString("buttonPromptString", Class'KFMission_LocalizedStrings'.default.ObjectivesString);
    }
    bInitialAutoExpandCheckComplete = true;
    Refresh();
}

function UpdateWeeklyUIActive(bool bShow)
{
    SetBool("weeklyEventActive", bShow);
}

function UpdateSpecialEventActive()
{
    SetBool("seasonalEventActive", ShowShouldSpecialEvent());
}

function bool ShowShouldSpecialEvent()
{
    local KFPlayerController KFPC;

    KFPC = KFPlayerController(Outer.GetPC());
    return ((Class'KFGameEngine'.static.GetSeasonalEventID() != 0) && Class'KFGameEngine'.static.GetSeasonalEventID() != -1) && KFPC.IsValidSpecialEventMap() || Class'WorldInfo'.static.IsMenuLevel();
}

function Refresh(optional bool bRepopulateCollapsed)
{
    if(ExpandedObjectiveContainer.Refresh())
    {
        CollapsedObjectiveContainer.PopulateData();
    }
}
