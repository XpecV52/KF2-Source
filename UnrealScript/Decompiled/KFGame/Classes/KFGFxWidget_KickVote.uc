/*******************************************************************************
 * KFGFxWidget_KickVote generated by Eliot.UELib using UE Explorer.
 * Eliot.UELib ? 2009-2022 Eliot van Uytfanghe. All rights reserved.
 * http://eliotvu.com
 *
 * All rights belong to their respective owners.
 *******************************************************************************/
class KFGFxWidget_KickVote extends GFxObject within GFxMoviePlayer;

var const localized string VoteKickString;
var const localized string VoteSkipTraderString;
var const localized string VoteSkipTraderDetailString;
var bool bIsVoteActive;
var bool bIsSkipTraderVoteActive;
var bool bShowChoicesOnTimerUpdate;
var const string GBA_VoteYes;
var const string GBA_VoteNo;
var GFxObject KickVoteData;

function InitializeHUD();

function LocalizeText(bool bIsSkipTraderVote)
{
    local GFxObject TempObject;
    local KFPlayerInput KFInput;
    local KeyBind TempKeyBind;

    TempObject = Outer.CreateObject("Object");
    KFInput = KFPlayerInput(Outer.GetPC().PlayerInput);
    KFInput.GetKeyBindFromCommand(TempKeyBind, GBA_VoteYes);
    TempObject.SetString("yesKey", string(TempKeyBind.Name));
    KFInput.GetKeyBindFromCommand(TempKeyBind, GBA_VoteNo);
    TempObject.SetString("noKey", string(TempKeyBind.Name));
    TempObject.SetString("yes", Class'KFCommon_LocalizedStrings'.default.YesString);
    TempObject.SetString("no", Class'KFCommon_LocalizedStrings'.default.NoString);
    if(bIsSkipTraderVote)
    {
        TempObject.SetString("voteKick", VoteSkipTraderString);        
    }
    else
    {
        TempObject.SetString("voteKick", VoteKickString);
    }
    SetObject("localizedText", TempObject);
}

function ResetVote()
{
    bShowChoicesOnTimerUpdate = false;
    ActionScriptVoid("onYesReleased");
    ActionScriptVoid("onNoReleased");
}

function ShowVote(PlayerReplicationInfo PRI, byte VoteDuration, bool bShowChoices, bool bIsSkipTraderVote)
{
    if(PRI != none)
    {
        LocalizeText(bIsSkipTraderVote);
        bIsVoteActive = true;
        bIsSkipTraderVoteActive = bIsSkipTraderVote;
        SendVoteToAS3(PRI.PlayerName, VoteDuration, bShowChoices);        
    }
    else
    {
        bIsVoteActive = false;
        bIsSkipTraderVoteActive = false;
    }
}

function SendVoteToAS3(string PlayerName, byte VoteDuration, bool bShowChoices)
{
    if(KickVoteData == none)
    {
        KickVoteData = Outer.CreateObject("Object");
    }
    if(bIsSkipTraderVoteActive)
    {
        KickVoteData.SetString("playerName", PlayerName @ VoteSkipTraderDetailString);        
    }
    else
    {
        KickVoteData.SetString("playerName", PlayerName);
    }
    KickVoteData.SetInt("voteDuration", VoteDuration);
    KickVoteData.SetBool("bShowChoices", bShowChoices);
    bShowChoicesOnTimerUpdate = bShowChoices;
    SetObject("kickVoteData", KickVoteData);
    UpdateUsingGamePad(Outer.GetPC().PlayerInput.bUsingGamepad);
}

function UpdateVoteDuration(byte VoteDuration)
{
    if(KickVoteData != none)
    {
        KickVoteData.SetInt("voteDuration", VoteDuration);
        KickVoteData.SetBool("bShowChoices", bShowChoicesOnTimerUpdate);
        SetObject("kickVoteData", KickVoteData);
        UpdateUsingGamePad(Outer.GetPC().PlayerInput.bUsingGamepad);
    }
}

function UpdateUsingGamePad(bool bIsUsingGamepad)
{
    SetBool("bUsingGamepad", bIsUsingGamepad);
    if(!bIsUsingGamepad)
    {
        LocalizeText(bIsSkipTraderVoteActive);
    }
}

function UpdateVoteCount(byte YesVotes, byte NoVotes)
{
    ActionScriptVoid("updateKickVoteCount");
}

function VoteClosed()
{
    bIsVoteActive = false;
    SetVisible(false);
}

function OnYesPressed()
{
    if(bIsVoteActive)
    {
        ActionScriptVoid("onYesPressed");
    }
}

function OnYesReleased()
{
    if(bIsVoteActive)
    {
        ActionScriptVoid("onYesReleased");
    }
}

function OnNoPressed()
{
    if(bIsVoteActive)
    {
        ActionScriptVoid("onNoPressed");
    }
}

function OnNoReleased()
{
    if(bIsVoteActive)
    {
        ActionScriptVoid("onNoReleased");
    }
}

defaultproperties
{
    VoteKickString="Kick Player?"
    VoteSkipTraderString="Skip Trader?"
    VoteSkipTraderDetailString="wants to skip the countdown"
    GBA_VoteYes="GBA_VoteYes"
    GBA_VoteNo="GBA_VoteNo"
}