/*******************************************************************************
 * KFPawn_MonsterBoss generated by Eliot.UELib using UE Explorer.
 * Eliot.UELib ? 2009-2022 Eliot van Uytfanghe. All rights reserved.
 * http://eliotvu.com
 *
 * All rights belong to their respective owners.
 *******************************************************************************/
class KFPawn_MonsterBoss extends KFPawn_Monster
    abstract
    native(Pawn)
    config(Game)
    hidecategories(Navigation);

struct native BossMinionWaveInfo
{
    var KFAIWaveInfo PhaseOneWave;
    var KFAIWaveInfo PhaseTwoWave;
    var KFAIWaveInfo PhaseThreeWave;

    structdefaultproperties
    {
        PhaseOneWave=none
        PhaseTwoWave=none
        PhaseThreeWave=none
    }
};

var KFPlayerController KFPC;
var const localized string BossName;
var const localized array<localized string> BossCaptionStrings;
var BossMinionWaveInfo SummonWaves[4];
var int NumMinionsToSpawn;
var repnotify int CurrentBattlePhase;
var bool bUseAnimatedTheatricCamera;
var name TheatricCameraSocketName;
var Vector TheatricCameraAnimOffset;

replication
{
     if(bNetDirty)
        CurrentBattlePhase;
}

simulated event ReplicatedEvent(name VarName)
{
    if(VarName == 'CurrentBattlePhase')
    {
        OnBattlePhaseChanged();        
    }
    else
    {
        super.ReplicatedEvent(VarName);
    }
}

simulated event PreBeginPlay()
{
    super.PreBeginPlay();
    OnBattlePhaseChanged();
    KFPC = KFPlayerController(GetALocalPlayerController());
    if(KFPC != none)
    {
        if((KFPC.MyGFxHUD != none) && KFPC.MyGFxHUD.bossHealthBar != none)
        {
            KFPC.MyGFxHUD.bossHealthBar.SetBossPawn(self);
        }
    }
}

event PostBeginPlay()
{
    super(KFPawn).PostBeginPlay();
    if(WorldInfo.GRI.GameClass.static.AllowAnalyticsLogging())
    {
        WorldInfo.TWLogEvent("boss_spawn", none, string(Class.Name));
    }
}

function PossessedBy(Controller C, bool bVehicleTransition)
{
    super.PossessedBy(C, bVehicleTransition);
    PlayBossMusic();
}

function NotifyTakeHit(Controller InstigatedBy, Vector HitLocation, int Damage, class<DamageType> DamageType, Vector Momentum, Actor DamageCauser)
{
    super.NotifyTakeHit(InstigatedBy, HitLocation, Damage, DamageType, Momentum, DamageCauser);
    if(((Role == ROLE_Authority) && KFGameInfo(WorldInfo.Game) != none) && KFGameInfo(WorldInfo.Game).DialogManager != none)
    {
        KFGameInfo(WorldInfo.Game).DialogManager.PlayBossTakeDamageDialog(self);
    }
}

function bool CanAITargetThisPawn(Controller TargetingController)
{
    if(TargetingController.Pawn.IsSameTeam(self))
    {
        return false;
    }
    return super(KFPawn).CanAITargetThisPawn(TargetingController);
}

simulated function PlayDying(class<DamageType> DamageType, Vector HitLoc)
{
    local KFGameReplicationInfo KFGRI;

    super.PlayDying(DamageType, HitLoc);
    Class'GameEngine'.static.GetOnlineSubsystem().PlayerInterfaceEx.PostActivityFeedBossKill(BossName, Class'KFUIDataStore_GameResource'.static.GetMapSummaryFromMapName(WorldInfo.GetMapName(true)).DisplayName);
    KFGRI = KFGameReplicationInfo(WorldInfo.GRI);
    if((KFGRI != none) && !KFGRI.IsFinalWave())
    {
        return;
    }
    if(KFPC != none)
    {
        KFPC.SetBossCamera(self);
    }
}

simulated function TerminateEffectsOnDeath()
{
    super(KFPawn).TerminateEffectsOnDeath();
    OnBattlePhaseChanged();
}

simulated function UpdateGameplayMICParams()
{
    super.UpdateGameplayMICParams();
    OnBattlePhaseChanged();
}

simulated function int GetCurrentBattlePhase()
{
    return CurrentBattlePhase;
}

simulated function OnBattlePhaseChanged()
{
    UpdateBattlePhaseOnLocalPlayerUI();
}

simulated function UpdateBattlePhaseOnLocalPlayerUI()
{
    if(!KFPC.IsLocalController())
    {
        return;
    }
    if(((KFPC != none) && KFPC.MyGFxHUD != none) && KFPC.MyGFxHUD.bossHealthBar != none)
    {
        KFPC.MyGFxHUD.bossHealthBar.UpdateBossBattlePhase(CurrentBattlePhase);
    }
}

static function bool IsABoss()
{
    return true;
}

function bool Died(Controller Killer, class<DamageType> DamageType, Vector HitLocation)
{
    local bool Result;

    Result = super.Died(Killer, DamageType, HitLocation);
    if(Result)
    {
        KFGameInfo(WorldInfo.Game).BossDied(Killer);
    }
    return Result;
}

function bool ShouldDrawBossIcon()
{
    return false;
}

function PlayBossMusic();

function CauseHeadTrauma(optional float BleedOutTime)
{
    BleedOutTime = 5;
}

simulated function PlayHeadAsplode();

function PlayMonologue(byte MonologueType);

function PlayGrabDialog()
{
    if(((Role == ROLE_Authority) && KFGameInfo(WorldInfo.Game) != none) && KFGameInfo(WorldInfo.Game).DialogManager != none)
    {
        KFGameInfo(WorldInfo.Game).DialogManager.PlayBossGrabDialog(self);
    }
}

function PlayHealDialog()
{
    if(((Role == ROLE_Authority) && KFGameInfo(WorldInfo.Game) != none) && KFGameInfo(WorldInfo.Game).DialogManager != none)
    {
        KFGameInfo(WorldInfo.Game).DialogManager.PlayBossHealDialog(self);
    }
}

function PlayLeapedDialog()
{
    if(((Role == ROLE_Authority) && KFGameInfo(WorldInfo.Game) != none) && KFGameInfo(WorldInfo.Game).DialogManager != none)
    {
        KFGameInfo(WorldInfo.Game).DialogManager.PlayBossLeapedDialog(self);
    }
}

function PlayLandedDialog()
{
    if(((Role == ROLE_Authority) && KFGameInfo(WorldInfo.Game) != none) && KFGameInfo(WorldInfo.Game).DialogManager != none)
    {
        KFGameInfo(WorldInfo.Game).DialogManager.PlayBossLandedDialog(self);
    }
}

function PlayGrabbedPlayerDialog(KFPawn_Human Target);

function PlayGrabKilledDialog();

defaultproperties
{
    BossName="Boss"
    BossCaptionStrings(0)="Boss caption 1"
    BossCaptionStrings(1)="Boss caption 2"
    MinSpawnSquadSizeType=ESquadType.EST_Boss
    MeleeAttackHelper=KFMeleeHelperAI'Default__KFPawn_MonsterBoss.MeleeHelper'
    begin object name=ThirdPersonHead0 class=SkeletalMeshComponent
        ReplacementPrimitive=none
    object end
    // Reference: SkeletalMeshComponent'Default__KFPawn_MonsterBoss.ThirdPersonHead0'
    ThirdPersonHeadMeshComponent=ThirdPersonHead0
    bWeakZedGrab=false
    AfflictionHandler=KFAfflictionManager'Default__KFPawn_MonsterBoss.Afflictions'
    begin object name=FirstPersonArms class=KFSkeletalMeshComponent
        ReplacementPrimitive=none
    object end
    // Reference: KFSkeletalMeshComponent'Default__KFPawn_MonsterBoss.FirstPersonArms'
    ArmsMesh=FirstPersonArms
    begin object name=SpecialMoveHandler class=KFSpecialMoveHandler
        SpecialMoveClasses(0)=none
        SpecialMoveClasses(1)=class'KFSM_MeleeAttack'
        SpecialMoveClasses(2)=class'KFSM_DoorMeleeAttack'
        SpecialMoveClasses(3)=class'KFSM_GrappleCombined'
        SpecialMoveClasses(4)=class'KFSM_Stumble'
        SpecialMoveClasses(5)=class'KFSM_RecoverFromRagdoll'
        SpecialMoveClasses(6)=class'KFSM_RagdollKnockdown'
        SpecialMoveClasses(7)=class'KFSM_DeathAnim'
        SpecialMoveClasses(8)=class'KFSM_Stunned'
        SpecialMoveClasses(9)=class'KFSM_Frozen'
        SpecialMoveClasses(10)=none
        SpecialMoveClasses(11)=none
        SpecialMoveClasses(12)=class'KFSM_Zed_Taunt'
        SpecialMoveClasses(13)=class'KFSM_Zed_WalkingTaunt'
        SpecialMoveClasses(14)=none
        SpecialMoveClasses(15)=none
        SpecialMoveClasses(16)=none
        SpecialMoveClasses(17)=none
        SpecialMoveClasses(18)=none
        SpecialMoveClasses(19)=none
        SpecialMoveClasses(20)=none
        SpecialMoveClasses(21)=none
        SpecialMoveClasses(22)=none
        SpecialMoveClasses(23)=none
        SpecialMoveClasses(24)=none
        SpecialMoveClasses(25)=none
        SpecialMoveClasses(26)=none
        SpecialMoveClasses(27)=class'KFSM_GrappleVictim'
        SpecialMoveClasses(28)=class'KFSM_HansGrappleVictim'
        SpecialMoveClasses(29)=none
        SpecialMoveClasses(30)=class'KFSM_Zed_Boss_Theatrics'
    object end
    // Reference: KFSpecialMoveHandler'Default__KFPawn_MonsterBoss.SpecialMoveHandler'
    SpecialMoveHandler=SpecialMoveHandler
    AmbientAkComponent=AkComponent'Default__KFPawn_MonsterBoss.AmbientAkSoundComponent_1'
    WeaponAkComponent=AkComponent'Default__KFPawn_MonsterBoss.AmbientAkSoundComponent'
    WeaponAmbientEchoHandler=KFWeaponAmbientEchoHandler'Default__KFPawn_MonsterBoss.WeaponAmbientEchoHandler'
    FootstepAkComponent=AkComponent'Default__KFPawn_MonsterBoss.FootstepAkSoundComponent'
    DialogAkComponent=AkComponent'Default__KFPawn_MonsterBoss.DialogAkSoundComponent'
    begin object name=KFPawnSkeletalMeshComponent class=KFSkeletalMeshComponent
        bUpdateKinematicBonesFromAnimation=true
        ReplacementPrimitive=none
    object end
    // Reference: KFSkeletalMeshComponent'Default__KFPawn_MonsterBoss.KFPawnSkeletalMeshComponent'
    Mesh=KFPawnSkeletalMeshComponent
    begin object name=CollisionCylinder class=CylinderComponent
        ReplacementPrimitive=none
    object end
    // Reference: CylinderComponent'Default__KFPawn_MonsterBoss.CollisionCylinder'
    CylinderComponent=CollisionCylinder
    begin object name=Sprite class=SpriteComponent
        ReplacementPrimitive=none
    object end
    // Reference: SpriteComponent'Default__KFPawn_MonsterBoss.Sprite'
    Components(0)=Sprite
    begin object name=CollisionCylinder class=CylinderComponent
        ReplacementPrimitive=none
    object end
    // Reference: CylinderComponent'Default__KFPawn_MonsterBoss.CollisionCylinder'
    Components(1)=CollisionCylinder
    begin object name=Arrow class=ArrowComponent
        ReplacementPrimitive=none
    object end
    // Reference: ArrowComponent'Default__KFPawn_MonsterBoss.Arrow'
    Components(2)=Arrow
    begin object name=KFPawnSkeletalMeshComponent class=KFSkeletalMeshComponent
        bUpdateKinematicBonesFromAnimation=true
        ReplacementPrimitive=none
    object end
    // Reference: KFSkeletalMeshComponent'Default__KFPawn_MonsterBoss.KFPawnSkeletalMeshComponent'
    Components(3)=KFPawnSkeletalMeshComponent
    Components(4)=AkComponent'Default__KFPawn_MonsterBoss.AmbientAkSoundComponent'
    Components(5)=AkComponent'Default__KFPawn_MonsterBoss.AmbientAkSoundComponent_1'
    Components(6)=AkComponent'Default__KFPawn_MonsterBoss.FootstepAkSoundComponent'
    Components(7)=AkComponent'Default__KFPawn_MonsterBoss.DialogAkSoundComponent'
    bAlwaysRelevant=true
    begin object name=CollisionCylinder class=CylinderComponent
        ReplacementPrimitive=none
    object end
    // Reference: CylinderComponent'Default__KFPawn_MonsterBoss.CollisionCylinder'
    CollisionComponent=CollisionCylinder
}