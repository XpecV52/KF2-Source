/*******************************************************************************
 * KFGFxWidget_BossHealthBar generated by Eliot.UELib using UE Explorer.
 * Eliot.UELib ? 2009-2022 Eliot van Uytfanghe. All rights reserved.
 * http://eliotvu.com
 *
 * All rights belong to their respective owners.
 *******************************************************************************/
class KFGFxWidget_BossHealthBar extends GFxObject within GFxMoviePlayer;

var GFxObject bossNameTextField;
var KFPawn_MonsterBoss BossPawn;
var float UpdateTickTime;
var float LastUpdateTime;
var array<int> BattlePhaseColors;
var KFPlayerController KFPC;

function InitializeHUD()
{
    KFPC = KFPlayerController(Outer.GetPC());
    bossNameTextField = GetObject("bossnameText");
}

function TickHud(float DeltaTime)
{
    if(KFPC.bHideBossHealthBar)
    {
        return;
    }
    if(BossPawn != none)
    {
        if((Outer.GetPC() != none) && (Outer.GetPC().WorldInfo.TimeSeconds - LastUpdateTime) > UpdateTickTime)
        {
            UpdateBossHealth();
        }
    }
}

function SetBossPawn(KFPawn_MonsterBoss NewBossPawn)
{
    local string BossNameText;

    if(KFPC.bHideBossHealthBar)
    {
        return;
    }
    if(NewBossPawn == none)
    {
        return;
    }
    BossPawn = NewBossPawn;
    BossNameText = BossPawn.BossName;
    if(BossPawn.IsHumanControlled())
    {
        BossNameText = ((BossNameText $ "(") $ string(BossPawn.Controller.PlayerReplicationInfo)) $ ")";
    }
    SetBossName(BossNameText);
    UpdateBossHealth();
}

function OnNamePlateHidden()
{
    if(KFPC.bHideBossHealthBar)
    {
        return;
    }
    if(BossPawn != none)
    {
        SetVisible(true);
    }
}

function SetBossName(string BossName)
{
    if(bossNameTextField != none)
    {
        bossNameTextField.SetText(BossName);
    }
}

function UpdateBossHealth()
{
    SetFloat("currentHealthPercentValue", float(BossPawn.Health) / float(BossPawn.HealthMax));
}

function UpdateBossBattlePhase(int BattlePhase)
{
    SetInt("currentBattlePhaseColor", BattlePhaseColors[BattlePhase - 1]);
}

function UpdateBossShield(float NewShieldPercect)
{
    SetFloat("currentShieldPercecntValue", NewShieldPercect);
}

defaultproperties
{
    UpdateTickTime=0.1
    BattlePhaseColors(0)=47202
    BattlePhaseColors(1)=16756736
    BattlePhaseColors(2)=16736256
    BattlePhaseColors(3)=11343377
    BattlePhaseColors(4)=0
}