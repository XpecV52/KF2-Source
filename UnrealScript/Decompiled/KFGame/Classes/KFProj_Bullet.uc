/*******************************************************************************
 * KFProj_Bullet generated by Eliot.UELib using UE Explorer.
 * Eliot.UELib ? 2009-2022 Eliot van Uytfanghe. All rights reserved.
 * http://eliotvu.com
 *
 * All rights belong to their respective owners.
 *******************************************************************************/
class KFProj_Bullet extends KFProjectile
    abstract
    native
    hidecategories(Navigation);

var bool bCheckRackEmUp;
var float ProjEffectsScale;

simulated event HitWall(Vector HitNormal, Actor Wall, PrimitiveComponent WallComp)
{
    if(bCheckRackEmUp && LastTouchComponent == none)
    {
        CheckForComboBreaker();
        bCheckRackEmUp = false;
    }
    super(Projectile).HitWall(HitNormal, Wall, WallComp);
}

// Export UKFProj_Bullet::execCheckForComboBreaker(FFrame&, void* const)
protected native simulated function CheckForComboBreaker();

simulated function ProcessTouch(Actor Other, Vector HitLocation, Vector HitNormal)
{
    local KFPawn KFP;
    local bool bPassThrough;

    if(Other != Instigator)
    {
        if(!Other.bStatic && DamageRadius == 0)
        {
            if(CheckRepeatingTouch(Other))
            {
                return;
            }
            ProcessBulletTouch(Other, HitLocation, HitNormal);
            if((PenetrationPower > float(0)) || PassThroughDamage(Other))
            {
                KFP = KFPawn(Other);
                if(KFP != none)
                {
                    PenetrationPower -= KFP.PenetrationResistance;
                }
                bPassThrough = true;
            }            
        }
        else
        {
            if(((DamageRadius == 0) && !Other.bBlockActors) && Other.IsA('KFWaterMeshActor'))
            {
                if(WorldInfo.NetMode != NM_DedicatedServer)
                {
                    KFImpactEffectManager(WorldInfo.MyImpactEffectManager).PlayImpactEffects(HitLocation, Instigator,, ImpactEffects);
                }
                bPassThrough = true;
            }
        }
        if(!bPassThrough)
        {
            super.ProcessTouch(Other, HitLocation, HitNormal);
        }
    }
}

simulated function bool PassThroughDamage(Actor HitActor)
{
    if(!HitActor.bBlockActors && HitActor.IsA('InteractiveFoliageActor'))
    {
        return true;
    }
    return false;
}

simulated function TriggerExplosion(Vector HitLocation, Vector HitNormal, Actor HitActor)
{
    if(ExplosionTemplate != none)
    {
        super.TriggerExplosion(HitLocation, HitNormal, HitActor);
        return;
    }
    if(WorldInfo.NetMode != NM_DedicatedServer)
    {
        KFImpactEffectManager(WorldInfo.MyImpactEffectManager).PlayImpactEffects(HitLocation, Instigator,, ImpactEffects);
    }
}

simulated event Tick(float DeltaTime)
{
    local float DeltaFade;
    local Vector ScaleVector;

    super.Tick(DeltaTime);
    if((WorldInfo.NetMode != NM_DedicatedServer) && ProjEffects != none)
    {
        if(!bFadingOutProjEffects)
        {
            if(ProjEffectsScale < 1)
            {
                ProjEffectsScale += (DeltaTime * (default.Speed / float(950)));                
            }
            else
            {
                ProjEffectsScale = 1;
            }
            ScaleVector = vect(1, 1, 1);
            ScaleVector *= ProjEffectsScale;
            ProjEffects.SetVectorParameter('Scale_Tracer', ScaleVector);
            ProjEffects.SetVectorParameter('Scale_Distortion', ScaleVector);            
        }
        else
        {
            if(bFadingOutProjEffects && ProjEffectsFadeOutDuration >= 0)
            {
                DeltaFade = ProjEffectsFadeOutDuration / default.ProjEffectsFadeOutDuration;
                ScaleVector = vect(1, 1, 1);
                ScaleVector *= Lerp(ProjEffectsScale, 0, 1 - DeltaFade);
                ProjEffects.SetVectorParameter('Scale_Tracer', ScaleVector);
                ProjEffects.SetVectorParameter('Scale_Distortion', ScaleVector);
            }
        }
    }
}

defaultproperties
{
    bSyncToOriginalLocation=true
    bSyncToThirdPersonMuzzleLocation=true
    bNoReplicationToInstigator=true
    bUseClientSideHitDetection=true
    bDamageDestructiblesOnTouch=true
    bWaitForEffects=true
    bAutoStartAmbientSound=true
    bStopAmbientSoundOnExplode=true
    bAmbientSoundZedTimeOnly=true
    TouchTimeThreshhold=0.15
    ProjEffectsFadeOutDuration=0.25
    AmbientSoundPlayEvent=AkEvent'WW_WEP_Bullet_FlyBys.Play_WEP_Bullet_Flyby_Small'
    AmbientSoundStopEvent=AkEvent'WW_WEP_Bullet_FlyBys.Stop_WEP_Bullet_Flyby_Small'
    begin object name=AmbientAkSoundComponent class=AkComponent
        bStopWhenOwnerDestroyed=true
        bForceOcclusionUpdateInterval=true
        OcclusionUpdateInterval=0.1
    object end
    // Reference: AkComponent'Default__KFProj_Bullet.AmbientAkSoundComponent'
    AmbientComponent=AmbientAkSoundComponent
    ImpactEffects=KFImpactEffectInfo'FX_Impacts_ARCH.Light_bullet_impact'
    Speed=50000
    MaxSpeed=50000
    bRotationFollowsVelocity=true
    Damage=10
    DamageRadius=0
    begin object name=CollisionCylinder class=CylinderComponent
        ReplacementPrimitive=none
    object end
    // Reference: CylinderComponent'Default__KFProj_Bullet.CollisionCylinder'
    CylinderComponent=CollisionCylinder
    begin object name=CollisionCylinder class=CylinderComponent
        ReplacementPrimitive=none
    object end
    // Reference: CylinderComponent'Default__KFProj_Bullet.CollisionCylinder'
    Components(0)=CollisionCylinder
    begin object name=AmbientAkSoundComponent class=AkComponent
        bStopWhenOwnerDestroyed=true
        bForceOcclusionUpdateInterval=true
        OcclusionUpdateInterval=0.1
    object end
    // Reference: AkComponent'Default__KFProj_Bullet.AmbientAkSoundComponent'
    Components(1)=AmbientAkSoundComponent
    bCollideComplex=true
    LifeSpan=4
    begin object name=CollisionCylinder class=CylinderComponent
        ReplacementPrimitive=none
    object end
    // Reference: CylinderComponent'Default__KFProj_Bullet.CollisionCylinder'
    CollisionComponent=CollisionCylinder
}