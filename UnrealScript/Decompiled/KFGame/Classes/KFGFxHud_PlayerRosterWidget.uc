/*******************************************************************************
 * KFGFxHud_PlayerRosterWidget generated by Eliot.UELib using UE Explorer.
 * Eliot.UELib ? 2009-2022 Eliot van Uytfanghe. All rights reserved.
 * http://eliotvu.com
 *
 * All rights belong to their respective owners.
 *******************************************************************************/
class KFGFxHud_PlayerRosterWidget extends GFxObject within GFxMoviePlayer;

struct SZedPlayerInfo
{
    var string AvatarPath;
    var int PlayerID;

    structdefaultproperties
    {
        AvatarPath=""
        PlayerID=-1
    }
};

var array<SZedPlayerInfo> ZedPlayerInfoList;
var PlayerReplicationInfo MyPRI;

function InitializeHUD()
{
    MyPRI = Outer.GetPC().PlayerReplicationInfo;
}

function TickHud(float DeltaTime)
{
    UpdatePlayerData();
}

function UpdatePlayerData()
{
    local GFxObject DataProvider, TempData;
    local int I, PlayerIndex;
    local KFPlayerReplicationInfo KFPRI;
    local KFPlayerController KFPC;
    local KFGameReplicationInfo KFGRI;
    local array<KFPlayerReplicationInfo> CurrentPlayerList;
    local string AvatarIconPath;
    local SZedPlayerInfo ZedPlayerInfo;
    local int SearchIndex;

    KFGRI = KFGameReplicationInfo(Outer.GetPC().WorldInfo.GRI);
    if(KFGRI == none)
    {
        return;
    }
    if(MyPRI == none)
    {
        return;
    }
    PlayerIndex = 0;
    KFGRI.GetKFPRIArray(CurrentPlayerList);
    KFPC = KFPlayerController(Outer.GetPC());
    DataProvider = Outer.CreateArray();
    I = 0;
    J0x118:

    if(I < CurrentPlayerList.Length)
    {
        if((CurrentPlayerList[I].GetTeamNum() == MyPRI.GetTeamNum()) && MyPRI != CurrentPlayerList[I])
        {
            KFPRI = CurrentPlayerList[I];
            SearchIndex = ZedPlayerInfoList.Find('PlayerID', KFPRI.PlayerID;
            TempData = Outer.CreateObject("Object");
            if(Class'WorldInfo'.static.IsConsoleBuild(8))
            {
                if(SearchIndex == -1)
                {
                    AvatarIconPath = KFPC.GetPS4Avatar(KFPRI.PlayerName);
                    ZedPlayerInfo.PlayerID = KFPRI.PlayerID;
                    ZedPlayerInfo.AvatarPath = AvatarIconPath;
                    ZedPlayerInfoList.AddItem(ZedPlayerInfo;                    
                }
                else
                {
                    AvatarIconPath = ZedPlayerInfoList[SearchIndex].AvatarPath;
                }                
            }
            else
            {
                if(SearchIndex == -1)
                {
                    AvatarIconPath = KFPC.GetSteamAvatar(KFPRI.UniqueId);
                    ZedPlayerInfo.PlayerID = KFPRI.PlayerID;
                    ZedPlayerInfo.AvatarPath = AvatarIconPath;
                    ZedPlayerInfoList.AddItem(ZedPlayerInfo;                    
                }
                else
                {
                    AvatarIconPath = ZedPlayerInfoList[SearchIndex].AvatarPath;
                }
            }
            TempData.SetString("playerIcon", AvatarIconPath);
            if(KFPRI.CharPortrait != none)
            {
                TempData.SetString("zedIcon", "img://" $ PathName(KFPRI.CharPortrait));
            }
            TempData.SetFloat("health", ByteToFloat(KFPRI.PlayerHealthPercent) * float(100));
            DataProvider.SetElementObject(PlayerIndex, TempData);
            ++ PlayerIndex;
        }
        ++ I;
        goto J0x118;
    }
    SetObject("data", DataProvider);
}
