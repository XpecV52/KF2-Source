/*******************************************************************************
 * KFDroppedPickup_Cash generated by Eliot.UELib using UE Explorer.
 * Eliot.UELib ? 2009-2022 Eliot van Uytfanghe. All rights reserved.
 * http://eliotvu.com
 *
 * All rights belong to their respective owners.
 *******************************************************************************/
class KFDroppedPickup_Cash extends KFDroppedPickup
    hidecategories(Navigation);

var int CashAmount;
var PlayerReplicationInfo TosserPRI;
var AkEvent PickupSound;

function GiveTo(Pawn P)
{
    if(P.PlayerReplicationInfo != none)
    {
        if(P.PlayerReplicationInfo != TosserPRI)
        {
            KFPawn_Human(P).UpdateDoshCaught(CashAmount, TosserPRI);
        }
        if(KFPlayerReplicationInfo(P.PlayerReplicationInfo) != none)
        {
            KFPlayerReplicationInfo(P.PlayerReplicationInfo).AddDosh(CashAmount);
            if(WorldInfo.GRI.GameClass.static.AllowAnalyticsLogging())
            {
                WorldInfo.TWLogEvent("dosh_picked_up", KFPlayerReplicationInfo(P.PlayerReplicationInfo), "#" $ string(CashAmount));
            }
        }
        bForceNetUpdate = true;
        P.PlaySoundBase(PickupSound);
        CheckForPayDayBonus(P);
    }
    PickedUpBy(P);
}

function CheckForPayDayBonus(Pawn ReceiverPawn)
{
    local KFGameReplicationInfo MyKFGRI;
    local KFPawn_Human KFPH;

    if(ReceiverPawn.PlayerReplicationInfo == TosserPRI)
    {
        return;
    }
    MyKFGRI = KFGameReplicationInfo(WorldInfo.GRI);
    if((MyKFGRI != none) && MyKFGRI.CurrentObjective != none)
    {
        KFPH = KFPawn_Human(ReceiverPawn);
        if((KFPH != none) && KFPH.bObjectivePlayer)
        {
            if(KFPlayerReplicationInfo(TosserPRI) != none)
            {
                KFPlayerReplicationInfo(TosserPRI).AddDosh(MyKFGRI.CurrentObjective.GetPayDayBonusDosh(CashAmount), true);
            }
        }
    }
}

simulated function SetPickupMesh(PrimitiveComponent NewPickupMesh)
{
    super.SetPickupMesh(NewPickupMesh);
    CollisionComponent.SetRBCollidesWithChannel(19, true);
}

event Destroyed()
{
    TosserPRI = none;
    Inventory = none;
}

defaultproperties
{
    PickupSound=AkEvent'WW_UI_PlayerCharacter.Play_UI_Pickup_Dosh'
    begin object name=Sprite class=SpriteComponent
        ReplacementPrimitive=none
    object end
    // Reference: SpriteComponent'Default__KFDroppedPickup_Cash.Sprite'
    Components(0)=Sprite
    begin object name=CollisionCylinder class=CylinderComponent
        ReplacementPrimitive=none
    object end
    // Reference: CylinderComponent'Default__KFDroppedPickup_Cash.CollisionCylinder'
    Components(1)=CollisionCylinder
    LifeSpan=120
    begin object name=CollisionCylinder class=CylinderComponent
        ReplacementPrimitive=none
    object end
    // Reference: CylinderComponent'Default__KFDroppedPickup_Cash.CollisionCylinder'
    CollisionComponent=CollisionCylinder
}