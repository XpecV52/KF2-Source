/*******************************************************************************
 * KFGFxPostGameContainer_MapVote generated by Eliot.UELib using UE Explorer.
 * Eliot.UELib ? 2009-2022 Eliot van Uytfanghe. All rights reserved.
 * http://eliotvu.com
 *
 * All rights belong to their respective owners.
 *******************************************************************************/
class KFGFxPostGameContainer_MapVote extends KFGFxObject_Container within GFxMoviePlayer;

var const localized string YourVoteString;
var const localized string TopVotesString;
var string MapVoteString;

function Initialize(KFGFxObject_Menu NewParentMenu)
{
    super.Initialize(NewParentMenu);
    LocalizeText();
    SetMapOptions();
}

function LocalizeText()
{
    local GFxObject TextObject;

    TextObject = Outer.CreateObject("Object");
    TextObject.SetString("yourVote", YourVoteString);
    TextObject.SetString("mapList", MapVoteString);
    TextObject.SetString("topVotes", TopVotesString);
    SetObject("localizedText", TextObject);
}

function SetMapOptions()
{
    local GFxObject MapList, MapObject;
    local int I, Counter;
    local array<string> ServerMapList;
    local KFGameReplicationInfo KFGRI;
    local bool IsBrokenTrader;

    KFGRI = KFGameReplicationInfo(Outer.GetPC().WorldInfo.GRI);
    Counter = 0;
    if((KFGRI != none) && KFGRI.VoteCollector != none)
    {
        ServerMapList = KFGRI.VoteCollector.MapList;
        IsBrokenTrader = Class'KFGameEngine'.static.GetWeeklyEventIndexMod() == 11;
        MapList = Outer.CreateArray();
        I = 0;
        J0x13B:

        if(I < ServerMapList.Length)
        {
            if(IsBrokenTrader && ((((ServerMapList[I] == "KF-Biolapse") || ServerMapList[I] == "KF-Nightmare") || ServerMapList[I] == "KF-PowerCore_Holdout") || ServerMapList[I] == "KF-TheDescent") || ServerMapList[I] == "KF-KrampusLair")
            {                
            }
            else
            {
                MapObject = Outer.CreateObject("Object");
                MapObject.SetString("label", Class'KFCommon_LocalizedStrings'.static.GetFriendlyMapName(ServerMapList[I]));
                MapObject.SetString("mapSource", GetMapSource(ServerMapList[I]));
                MapObject.SetInt("mapindex", I);
                MapList.SetElementObject(Counter, MapObject);
                ++ Counter;
            }
            ++ I;
            goto J0x13B;
        }
    }
    SetObject("mapChoices", MapList);
}

function RecieveTopMaps(const out TopVotes VoteObject)
{
    local GFxObject MapList;
    local KFGameReplicationInfo KFGRI;

    KFGRI = KFGameReplicationInfo(Outer.GetPC().WorldInfo.GRI);
    if((KFGRI != none) && KFGRI.VoteCollector != none)
    {
        MapList = Outer.CreateArray();
        if((VoteObject.Map1Name != "") && VoteObject.Map1Votes > 0)
        {
            MapList.SetElementObject(0, IndexToTopMapObject(VoteObject.Map1Name, VoteObject.Map1Votes));
        }
        if((VoteObject.Map2Name != "") && VoteObject.Map2Votes > 0)
        {
            MapList.SetElementObject(1, IndexToTopMapObject(VoteObject.Map2Name, VoteObject.Map2Votes));
        }
        if((VoteObject.Map3Name != "") && VoteObject.Map3Votes > 0)
        {
            MapList.SetElementObject(2, IndexToTopMapObject(VoteObject.Map3Name, VoteObject.Map3Votes));
        }
    }
    SetObject("currentVotes", MapList);
}

function GFxObject IndexToTopMapObject(string MapName, int VoteCount)
{
    local GFxObject MapObject;

    MapObject = Outer.CreateObject("Object");
    MapObject.SetString("label", Class'KFCommon_LocalizedStrings'.static.GetFriendlyMapName(MapName));
    MapObject.SetString("secondaryText", string(VoteCount));
    MapObject.SetString("mapSource", GetMapSource(MapName));
    return MapObject;
}

function string GetMapSource(string MapName)
{
    local KFMapSummary MapData;

    MapData = Class'KFUIDataStore_GameResource'.static.GetMapSummaryFromMapName(MapName);
    if(MapData != none)
    {
        return "img://" $ MapData.ScreenshotPathName;        
    }
    else
    {
        MapData = Class'KFUIDataStore_GameResource'.static.GetMapSummaryFromMapName("KF-Default");
        if(MapData != none)
        {
            return "img://" $ MapData.ScreenshotPathName;
        }
    }
}

defaultproperties
{
    YourVoteString="YOUR VOTE"
    TopVotesString="TOP VOTES"
}