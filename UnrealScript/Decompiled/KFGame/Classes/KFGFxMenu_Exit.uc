/*******************************************************************************
 * KFGFxMenu_Exit generated by Eliot.UELib using UE Explorer.
 * Eliot.UELib ? 2009-2022 Eliot van Uytfanghe. All rights reserved.
 * http://eliotvu.com
 *
 * All rights belong to their respective owners.
 *******************************************************************************/
class KFGFxMenu_Exit extends KFGFxObject_Menu within GFxMoviePlayer;

enum ExitOptions
{
    EO_TO_Main_Menu,
    EO_TO_OS,
    EO_TO_MAX
};

var const localized string HeaderString;
var const localized string ExitToMainDescription;
var const localized string ExitToMainMenu;
var const localized string ExitKF2;
var array<string> OptionStrings;

function InitializeMenu(KFGFxMoviePlayer_Manager InManager)
{
    super.InitializeMenu(InManager);
}

function OnOpen()
{
    SetExitOptions();
    HandleAutoExit();
}

function SetExitOptions()
{
    OptionStrings.Length = 0;
    OptionStrings.AddItem(ExitToMainMenu;
    OptionStrings.AddItem(ExitKF2;
    SetMenuText();
}

function SetMenuText()
{
    local byte I;
    local GFxObject DataProvider, DataObject;

    DataProvider = Outer.CreateArray();
    DataProvider.SetString("header", HeaderString);
    I = 0;
    J0x66:

    if(I < OptionStrings.Length)
    {
        DataObject = Outer.CreateObject("Object");
        DataObject.SetString("label", OptionStrings[I]);
        if(OptionStrings[I] == ExitToMainMenu)
        {
            DataObject.SetBool("enabled", !Class'WorldInfo'.static.IsMenuLevel());            
        }
        else
        {
            DataObject.SetBool("enabled", true);
        }
        DataProvider.SetElementObject(I, DataObject);
        ++ I;
        goto J0x66;
    }
    SetObject("buttonNames", DataProvider);
}

function Callback_MenuSelected(int MenuIndex)
{
    switch(MenuIndex)
    {
        case 1:
            ShowExitToOSPopUp();
            break;
        case 0:
            ShowLeaveGamePopUp();
            break;
        default:
            break;
    }
}

function HandleAutoExit()
{
    if(((Manager != none) && !Manager.bUsingGamepad) && Class'WorldInfo'.static.IsMenuLevel())
    {
        ShowExitToOSPopUp();
    }
}

function ShowExitToOSPopUp()
{
    if((Manager != none) && Manager.MenuBarWidget != none)
    {
        Manager.MenuBarWidget.OpenQuitPopUp();
    }
}

function ShowLeaveGamePopUp()
{
    if(Manager != none)
    {
        Manager.OpenPopup(0, ExitToMainMenu, ExitToMainDescription, Class'KFCommon_LocalizedStrings'.default.ConfirmString, Class'KFCommon_LocalizedStrings'.default.CancelString, OnLeaveGameConfirm);
    }
}

function OnLeaveGameConfirm()
{
    ConfirmLeaveParty();
}

defaultproperties
{
    HeaderString="EXIT GAME"
    ExitToMainDescription="Leave current game and return to the title screen?"
    ExitToMainMenu="Exit to Title Screen"
    ExitKF2="Exit to Desktop"
}