/*******************************************************************************
 * AmbientSoundSimpleToggleable generated by Eliot.UELib using UE Explorer.
 * Eliot.UELib ? 2009-2022 Eliot van Uytfanghe. All rights reserved.
 * http://eliotvu.com
 *
 * All rights belong to their respective owners.
 *******************************************************************************/
class AmbientSoundSimpleToggleable extends AmbientSoundSimple
    native(Sound)
    placeable
    hidecategories(Navigation,Audio)
    autoexpandcategories(Audio,AmbientSoundSimple,AmbientSoundSimpleToggleable);

struct CheckpointRecord
{
    var bool bCurrentlyPlaying;

    structdefaultproperties
    {
        bCurrentlyPlaying=false
    }
};

var repnotify bool bCurrentlyPlaying;
var() bool bFadeOnToggle;
var transient bool bIgnoreAutoPlay;
var() float FadeInDuration;
var() float FadeInVolumeLevel;
var() float FadeOutDuration;
var() float FadeOutVolumeLevel;

replication
{
     if(Role == ROLE_Authority)
        bCurrentlyPlaying;
}

simulated event PostBeginPlay()
{
    super(Actor).PostBeginPlay();
    bCurrentlyPlaying = AudioComponent.bAutoPlay;
}

simulated event ReplicatedEvent(name VarName)
{
    if(VarName == 'bCurrentlyPlaying')
    {
        if(bCurrentlyPlaying)
        {
            StartPlaying();            
        }
        else
        {
            StopPlaying();
        }        
    }
    else
    {
        super(Actor).ReplicatedEvent(VarName);
    }
}

simulated function StartPlaying()
{
    if(bFadeOnToggle)
    {
        AudioComponent.FadeIn(FadeInDuration, FadeInVolumeLevel);        
    }
    else
    {
        AudioComponent.Play();
    }
    bCurrentlyPlaying = true;
}

simulated function StopPlaying()
{
    if(bFadeOnToggle)
    {
        AudioComponent.FadeOut(FadeOutDuration, FadeOutVolumeLevel);        
    }
    else
    {
        AudioComponent.Stop();
    }
    bCurrentlyPlaying = false;
}

simulated function OnToggle(SeqAct_Toggle Action)
{
    if(Action.InputLinks[0].bHasImpulse || Action.InputLinks[2].bHasImpulse && !AudioComponent.bWasPlaying)
    {
        StartPlaying();        
    }
    else
    {
        bIgnoreAutoPlay = true;
        StopPlaying();
    }
    ForceNetRelevant();
}

function CreateCheckpointRecord(out CheckpointRecord Record)
{
    Record.bCurrentlyPlaying = bCurrentlyPlaying;
}

function ApplyCheckpointRecord(const out CheckpointRecord Record)
{
    bCurrentlyPlaying = Record.bCurrentlyPlaying;
    if(bCurrentlyPlaying)
    {
        StartPlaying();        
    }
    else
    {
        StopPlaying();
    }
}

defaultproperties
{
    FadeInDuration=1
    FadeInVolumeLevel=1
    FadeOutDuration=1
    SoundCueInstance=SoundCue'Default__AmbientSoundSimpleToggleable.SoundCue0'
    SoundNodeInstance=SoundNodeAmbient'Default__AmbientSoundSimpleToggleable.SoundNodeAmbient0'
    bAutoPlay=false
    begin object name=AudioComponent0 class=AudioComponent
        PreviewSoundRadius=DrawSoundRadiusComponent'Default__AmbientSoundSimpleToggleable.DrawSoundRadius0'
    object end
    // Reference: AudioComponent'Default__AmbientSoundSimpleToggleable.AudioComponent0'
    AudioComponent=AudioComponent0
    begin object name=Sprite class=SpriteComponent
        Sprite=Texture2D'EditorResources.AmbientSoundIcons.S_Ambient_Sound_Toggleable'
        ReplacementPrimitive=none
    object end
    // Reference: SpriteComponent'Default__AmbientSoundSimpleToggleable.Sprite'
    SpriteComp=Sprite
    begin object name=Sprite class=SpriteComponent
        Sprite=Texture2D'EditorResources.AmbientSoundIcons.S_Ambient_Sound_Toggleable'
        ReplacementPrimitive=none
    object end
    // Reference: SpriteComponent'Default__AmbientSoundSimpleToggleable.Sprite'
    Components(0)=Sprite
    begin object name=DrawSoundRadius0 class=DrawSoundRadiusComponent
        SphereColor=(B=102,G=255,R=255,A=255)
        ReplacementPrimitive=none
    object end
    // Reference: DrawSoundRadiusComponent'Default__AmbientSoundSimpleToggleable.DrawSoundRadius0'
    Components(1)=DrawSoundRadius0
    begin object name=AudioComponent0 class=AudioComponent
        PreviewSoundRadius=DrawSoundRadiusComponent'Default__AmbientSoundSimpleToggleable.DrawSoundRadius0'
    object end
    // Reference: AudioComponent'Default__AmbientSoundSimpleToggleable.AudioComponent0'
    Components(2)=AudioComponent0
    CollisionType=ECollisionType.COLLIDE_CustomDefault
    bStatic=false
    bNoDelete=true
}