/*******************************************************************************
 * Volume generated by Eliot.UELib using UE Explorer.
 * Eliot.UELib ? 2009-2022 Eliot van Uytfanghe. All rights reserved.
 * http://eliotvu.com
 *
 * All rights belong to their respective owners.
 *******************************************************************************/
class Volume extends Brush
    native
    nativereplication
    notplaceable
    hidecategories(Navigation,Object,Movement,Display);

var Actor AssociatedActor;
/** Should pawns be forced to walk when inside this volume? */
var() bool bForcePawnWalk;
/** Should process all actors within this volume */
var() bool bProcessAllActors;
/** Should this volume only collide with pawns */
var(Collision) bool bPawnsOnly;

// Export UVolume::execEncompasses(FFrame&, void* const)
native function bool Encompasses(Actor Other);

// Export UVolume::execEncompassesPoint(FFrame&, void* const)
native function bool EncompassesPoint(Vector Loc);

event PostBeginPlay()
{
    super(Actor).PostBeginPlay();
    if(AssociatedActor != none)
    {
        GotoState('AssociatedTouch');
        InitialState = GetStateName();
    }
}

simulated function DisplayDebug(HUD HUD, out float out_YL, out float out_YPos)
{
    super(Actor).DisplayDebug(HUD, out_YL, out_YPos);
    HUD.Canvas.DrawText("AssociatedActor " $ string(AssociatedActor), false);
    out_YPos += out_YL;
    HUD.Canvas.SetPos(4, out_YPos);
}

simulated function OnToggle(SeqAct_Toggle Action)
{
    if(Action.InputLinks[0].bHasImpulse)
    {
        if(!bCollideActors)
        {
            SetCollision(true, bBlockActors);
        }        
    }
    else
    {
        if(Action.InputLinks[1].bHasImpulse)
        {
            if(bCollideActors)
            {
                SetCollision(false, bBlockActors);
            }            
        }
        else
        {
            if(Action.InputLinks[2].bHasImpulse)
            {
                SetCollision(!bCollideActors, bBlockActors);
            }
        }
    }
    CollisionComponent.SetActorCollision(bCollideActors, CollisionComponent.BlockActors);
    ForceNetRelevant();
    SetForcedInitialReplicatedProperty(BoolProperty'bCollideActors', bCollideActors == default.bCollideActors);
}

simulated event CollisionChanged()
{
    CollisionComponent.SetBlockRigidBody(bCollideActors && bBlockActors);
}

event ProcessActorSetVolume(Actor Other);

state AssociatedTouch
{
    event Touch(Actor Other, PrimitiveComponent OtherComp, Vector HitLocation, Vector HitNormal)
    {
        AssociatedActor.Touch(Other, OtherComp, HitLocation, HitNormal);
    }

    event UnTouch(Actor Other)
    {
        AssociatedActor.UnTouch(Other);
    }

    event BeginState(name PreviousStateName)
    {
        local Actor A;

        foreach TouchingActors(Class'Actor', A)
        {
            Touch(A, none, A.Location, vect(0, 0, 1));            
        }        
    }
    stop;    
}

defaultproperties
{
    begin object name=BrushComponent0 class=BrushComponent
        ReplacementPrimitive=none
        bAcceptsLights=true
        CollideActors=true
        BlockNonZeroExtent=true
        bDisableAllRigidBody=true
        AlwaysLoadOnClient=true
        AlwaysLoadOnServer=true
        LightingChannels=(bInitialized=true,Indoor=true,Outdoor=true)
    object end
    // Reference: BrushComponent'Default__Volume.BrushComponent0'
    BrushComponent=BrushComponent0
    begin object name=BrushComponent0 class=BrushComponent
        ReplacementPrimitive=none
        bAcceptsLights=true
        CollideActors=true
        BlockNonZeroExtent=true
        bDisableAllRigidBody=true
        AlwaysLoadOnClient=true
        AlwaysLoadOnServer=true
        LightingChannels=(bInitialized=true,Indoor=true,Outdoor=true)
    object end
    // Reference: BrushComponent'Default__Volume.BrushComponent0'
    Components(0)=BrushComponent0
    CollisionType=ECollisionType.COLLIDE_TouchAllButWeapons
    bSkipActorPropertyReplication=true
    bCollideActors=true
    begin object name=BrushComponent0 class=BrushComponent
        ReplacementPrimitive=none
        bAcceptsLights=true
        CollideActors=true
        BlockNonZeroExtent=true
        bDisableAllRigidBody=true
        AlwaysLoadOnClient=true
        AlwaysLoadOnServer=true
        LightingChannels=(bInitialized=true,Indoor=true,Outdoor=true)
    object end
    // Reference: BrushComponent'Default__Volume.BrushComponent0'
    CollisionComponent=BrushComponent0
}