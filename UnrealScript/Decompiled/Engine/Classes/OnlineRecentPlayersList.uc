/*******************************************************************************
 * OnlineRecentPlayersList generated by Eliot.UELib using UE Explorer.
 * Eliot.UELib ? 2009-2022 Eliot van Uytfanghe. All rights reserved.
 * http://eliotvu.com
 *
 * All rights belong to their respective owners.
 *******************************************************************************/
class OnlineRecentPlayersList extends Object
    config(Engine);

struct RecentParty
{
    var UniqueNetId PartyLeader;
    var array<UniqueNetId> PartyMembers;

    structdefaultproperties
    {
        PartyLeader=(Uid=none)
        PartyMembers=none
    }
};

struct CurrentPlayerMet
{
    var int TeamNum;
    var int Skill;
    var UniqueNetId NetId;

    structdefaultproperties
    {
        TeamNum=0
        Skill=0
        NetId=(Uid=none)
    }
};

var array<UniqueNetId> RecentPlayers;
var array<RecentParty> RecentParties;
var RecentParty LastParty;
var config int MaxRecentPlayers;
var config int MaxRecentParties;
var int RecentPlayersAddIndex;
var int RecentPartiesAddIndex;
var private array<CurrentPlayerMet> CurrentPlayers;

function AddPlayerToRecentPlayers(UniqueNetId NewPlayer)
{
    local int FindIndex;

    FindIndex = RecentPlayers.Find('Uid', NewPlayer.Uid;
    if(FindIndex == -1)
    {
        if(RecentPlayersAddIndex >= MaxRecentPlayers)
        {
            RecentPlayersAddIndex = 0;
        }
        if((RecentPlayersAddIndex + 1) >= RecentPlayers.Length)
        {
            RecentPlayers.Length = RecentPlayersAddIndex + 1;
        }
        RecentPlayers[RecentPlayersAddIndex] = NewPlayer;
        ++ RecentPlayersAddIndex;
    }
}

function ClearRecentPlayers()
{
    RecentPlayersAddIndex = 0;
    RecentPlayers.Length = 0;
}

function AddPartyToRecentParties(UniqueNetId PartyLeader, const out array<UniqueNetId> PartyMembers)
{
    local int FindIndex;

    FindIndex = RecentParties.Find('PartyLeader', PartyLeader;
    if(FindIndex == -1)
    {
        if(RecentPartiesAddIndex >= MaxRecentParties)
        {
            RecentPartiesAddIndex = 0;
        }
        if((RecentPartiesAddIndex + 1) >= RecentParties.Length)
        {
            RecentParties.Length = RecentPartiesAddIndex + 1;
        }
        RecentParties[RecentPartiesAddIndex].PartyLeader = PartyLeader;
        RecentParties[RecentPartiesAddIndex].PartyMembers = PartyMembers;
        ++ RecentPartiesAddIndex;
    }
}

function ClearRecentParties()
{
    RecentPartiesAddIndex = 0;
    RecentParties.Length = 0;
}

function GetPlayersFromRecentParties(out array<UniqueNetId> Players)
{
    local int PartyIndex, MemberIndex, AddMemberAt;

    Players.Length = 0;
    AddMemberAt = 0;
    PartyIndex = 0;
    J0x22:

    if(PartyIndex < RecentParties.Length)
    {
        MemberIndex = 0;
        J0x45:

        if(MemberIndex < RecentParties[PartyIndex].PartyMembers.Length)
        {
            Players.Length = AddMemberAt + 1;
            Players[AddMemberAt] = RecentParties[PartyIndex].PartyMembers[MemberIndex];
            ++ MemberIndex;
            goto J0x45;
        }
        ++ PartyIndex;
        goto J0x22;
    }
}

function GetPlayersFromCurrentPlayers(out array<UniqueNetId> Players)
{
    local int PlayerIndex;

    Players.Length = 0;
    PlayerIndex = 0;
    J0x17:

    if(PlayerIndex < CurrentPlayers.Length)
    {
        Players.AddItem(CurrentPlayers[PlayerIndex].NetId;
        ++ PlayerIndex;
        goto J0x17;
    }
}

function int GetSkillForCurrentPlayer(UniqueNetId Player)
{
    local int PlayerIndex;

    PlayerIndex = 0;
    J0x0B:

    if(PlayerIndex < CurrentPlayers.Length)
    {
        if(CurrentPlayers[PlayerIndex].NetId == Player)
        {
            return CurrentPlayers[PlayerIndex].Skill;
        }
        ++ PlayerIndex;
        goto J0x0B;
    }
    return 0;
}

function int GetTeamForCurrentPlayer(UniqueNetId Player)
{
    local int PlayerIndex;

    PlayerIndex = 0;
    J0x0B:

    if(PlayerIndex < CurrentPlayers.Length)
    {
        if(CurrentPlayers[PlayerIndex].NetId == Player)
        {
            return CurrentPlayers[PlayerIndex].TeamNum;
        }
        ++ PlayerIndex;
        goto J0x0B;
    }
    return 255;
}

function SetLastParty(UniqueNetId PartyLeader, const out array<UniqueNetId> PartyMembers)
{
    LastParty.PartyLeader = PartyLeader;
    LastParty.PartyMembers = PartyMembers;
}

function bool ShowRecentPlayerList(byte LocalUserNum, string Title, string Description)
{
    local OnlineSubsystem OnlineSub;

    OnlineSub = Class'GameEngine'.static.GetOnlineSubsystem();
    if((OnlineSub != none) && NotEqual_InterfaceInterface(OnlineSub.PlayerInterfaceEx, (none)))
    {
        return OnlineSub.PlayerInterfaceEx.ShowCustomPlayersUI(LocalUserNum, RecentPlayers, Title, Description);
    }
    return false;
}

function bool ShowRecentPartiesPlayerList(byte LocalUserNum, string Title, string Description)
{
    local OnlineSubsystem OnlineSub;
    local array<UniqueNetId> Players;

    OnlineSub = Class'GameEngine'.static.GetOnlineSubsystem();
    if((OnlineSub != none) && NotEqual_InterfaceInterface(OnlineSub.PlayerInterfaceEx, (none)))
    {
        GetPlayersFromRecentParties(Players);
        return OnlineSub.PlayerInterfaceEx.ShowCustomPlayersUI(LocalUserNum, Players, Title, Description);
    }
    return false;
}

function bool ShowLastPartyPlayerList(byte LocalUserNum, string Title, string Description)
{
    local OnlineSubsystem OnlineSub;

    OnlineSub = Class'GameEngine'.static.GetOnlineSubsystem();
    if((OnlineSub != none) && NotEqual_InterfaceInterface(OnlineSub.PlayerInterfaceEx, (none)))
    {
        return OnlineSub.PlayerInterfaceEx.ShowCustomPlayersUI(LocalUserNum, LastParty.PartyMembers, Title, Description);
    }
    return false;
}

function bool ShowCurrentPlayersList(byte LocalUserNum, string Title, string Description)
{
    local OnlineSubsystem OnlineSub;
    local array<UniqueNetId> Players;

    OnlineSub = Class'GameEngine'.static.GetOnlineSubsystem();
    if((OnlineSub != none) && NotEqual_InterfaceInterface(OnlineSub.PlayerInterfaceEx, (none)))
    {
        GetPlayersFromCurrentPlayers(Players);
        return OnlineSub.PlayerInterfaceEx.ShowCustomPlayersUI(LocalUserNum, Players, Title, Description);
    }
    return false;
}

function DumpPlayersList(const out array<CurrentPlayerMet> Players)
{
    local OnlineSubsystem OnlineSub;
    local int PlayerIdx, TeamNum;
    local UniqueNetId NetId;

    OnlineSub = Class'GameEngine'.static.GetOnlineSubsystem();
    if(OnlineSub != none)
    {
        PlayerIdx = 0;
        J0x43:

        if(PlayerIdx < Players.Length)
        {
            NetId = Players[PlayerIdx].NetId;
            TeamNum = Players[PlayerIdx].TeamNum;
            LogInternal(((((("DumpPlayersList: " $ " TeamNum=") $ string(TeamNum)) $ " PlayerIdx=") $ string(PlayerIdx)) $ " UniqueId=") $ OnlineSub.UniqueNetIdToString(NetId), 'DevOnline');
            ++ PlayerIdx;
            goto J0x43;
        }
    }
}

function DumpCurrentPlayers()
{
    DumpPlayersList(CurrentPlayers);
}

function SetCurrentPlayersList(const array<CurrentPlayerMet> Players)
{
    DumpPlayersList(Players);
    CurrentPlayers = Players;
}

function int GetCurrentPlayersListCount()
{
    return CurrentPlayers.Length;
}

defaultproperties
{
    MaxRecentPlayers=100
    MaxRecentParties=5
}