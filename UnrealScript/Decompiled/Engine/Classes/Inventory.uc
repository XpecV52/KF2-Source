/*******************************************************************************
 * Inventory generated by Eliot.UELib using UE Explorer.
 * Eliot.UELib ? 2009-2022 Eliot van Uytfanghe. All rights reserved.
 * http://eliotvu.com
 *
 * All rights belong to their respective owners.
 *******************************************************************************/
class Inventory extends Actor
    abstract
    native
    nativereplication
    notplaceable
    hidecategories(Navigation);

var Inventory Inventory;
var InventoryManager InvManager;
var const localized string ItemName;
var bool bDropOnDeath;
var bool bDelayedSpawn;
var bool bPredictRespawns;
/** Respawn after this time, 0 for instant. */
var() float RespawnTime;
var float MaxDesireability;
/** Human readable description when picked up. */
var() const localized string PickupMessage;
var() SoundCue PickupSound;
var() string PickupForce;
var class<DroppedPickup> DroppedPickupClass;
var export editinline PrimitiveComponent DroppedPickupMesh;
var export editinline PrimitiveComponent PickupFactoryMesh;
var export editinline ParticleSystemComponent DroppedPickupParticles;

replication
{
     if(((Role == ROLE_Authority) && bNetDirty) && bNetOwner)
        InvManager, Inventory;
}

simulated function string GetHumanReadableName()
{
    return default.ItemName;
}

event Destroyed()
{
    if((Pawn(Owner) != none) && Pawn(Owner).InvManager != none)
    {
        Pawn(Owner).InvManager.RemoveFromInventory(self);
    }
}

static function float BotDesireability(Actor PickupHolder, Pawn P, Controller C)
{
    local Inventory AlreadyHas;
    local float desire;

    desire = default.MaxDesireability;
    if(default.RespawnTime < float(10))
    {
        AlreadyHas = P.FindInventoryType(default.Class);
        if(AlreadyHas != none)
        {
            return -1;
        }
    }
    return desire;
}

static function float DetourWeight(Pawn Other, float PathWeight)
{
    return 0;
}

final function GiveTo(Pawn Other)
{
    if((Other != none) && Other.InvManager != none)
    {
        Other.InvManager.AddInventory(self);
    }
}

function AnnouncePickup(Pawn Other)
{
    Other.HandlePickup(self);
    if(PickupSound != none)
    {
        Other.PlaySound(PickupSound);
    }
}

function GivenTo(Pawn thisPawn, optional bool bDoNotActivate)
{
    LogInternal((((((((((string(WorldInfo.TimeSeconds) @ "Self:") @ string(self)) @ "Instigator:") @ string(Instigator)) @ string(GetStateName())) $ "::") $ string(GetFuncName())) @ string(thisPawn)) @ "Weapon:") @ string(self), 'Inventory');
    Instigator = thisPawn;
    ClientGivenTo(thisPawn, bDoNotActivate);
}

reliable client simulated function ClientGivenTo(Pawn NewOwner, bool bDoNotActivate)
{
    SetOwner(NewOwner);
    Instigator = NewOwner;
    LogInternal((((((((((string(WorldInfo.TimeSeconds) @ "Self:") @ string(self)) @ "Instigator:") @ string(Instigator)) @ string(GetStateName())) $ "::") $ string(GetFuncName())) @ string(NewOwner)) @ "Weapon:") @ string(self), 'Inventory');
    if((NewOwner != none) && NewOwner.Controller != none)
    {
        NewOwner.Controller.NotifyAddInventory(self);
    }
}

function ItemRemovedFromInvManager();

function bool DenyPickupQuery(class<Inventory> ItemClass, Actor Pickup)
{
    if(ItemClass == Class)
    {
        return true;
    }
    return false;
}

function DropFrom(Vector StartLocation, Vector StartVelocity)
{
    local DroppedPickup P;

    if((Instigator != none) && Instigator.InvManager != none)
    {
        Instigator.InvManager.RemoveFromInventory(self);
    }
    if((DroppedPickupClass == none) || DroppedPickupMesh == none)
    {
        Destroy();
        return;
    }
    P = Spawn(DroppedPickupClass,,, StartLocation);
    if(P == none)
    {
        Destroy();
        return;
    }
    P.SetPhysics(2);
    P.Inventory = self;
    P.InventoryClass = Class;
    P.Velocity = StartVelocity;
    P.Instigator = Instigator;
    P.SetPickupMesh(DroppedPickupMesh);
    P.SetPickupParticles(DroppedPickupParticles);
    Instigator = none;
    GotoState('None');
}

static function string GetLocalString(optional int Switch, optional PlayerReplicationInfo RelatedPRI_1, optional PlayerReplicationInfo RelatedPRI_2)
{
    return default.PickupMessage;
}

defaultproperties
{
    MaxDesireability=0.1
    PickupMessage="Snagged an item."
    DroppedPickupClass=Class'DroppedPickup'
    begin object name=Sprite class=SpriteComponent
        SpriteCategoryName=Inventory
        ReplacementPrimitive=none
        HiddenGame=true
        AlwaysLoadOnClient=false
        AlwaysLoadOnServer=false
    object end
    // Reference: SpriteComponent'Default__Inventory.Sprite'
    Components(0)=Sprite
    RemoteRole=ENetRole.ROLE_SimulatedProxy
    CollisionType=ECollisionType.COLLIDE_CustomDefault
    bHidden=true
    bOnlyRelevantToOwner=true
    bReplicateMovement=false
    bOnlyDirtyReplication=true
    NetPriority=1.4
}