/*******************************************************************************
 * DataStoreClient generated by Eliot.UELib using UE Explorer.
 * Eliot.UELib ? 2009-2022 Eliot van Uytfanghe. All rights reserved.
 * http://eliotvu.com
 *
 * All rights belong to their respective owners.
 *******************************************************************************/
class DataStoreClient extends UIRoot
    native(UserInterface)
    config(Engine)
    hidecategories(Object,UIRoot);

struct native transient PlayerDataStoreGroup
{
    var init const transient LocalPlayer PlayerOwner;
    var init const transient array<UIDataStore> DataStores;

    structdefaultproperties
    {
        PlayerOwner=none
        DataStores=none
    }
};

var config array<config string> GlobalDataStoreClasses;
var const array<UIDataStore> GlobalDataStores;
var config array<config string> PlayerDataStoreClassNames;
var private const array< class<UIDataStore> > PlayerDataStoreClasses;
var const array<PlayerDataStoreGroup> PlayerDataStores;

// Export UDataStoreClient::execFindDataStore(FFrame&, void* const)
native final function UIDataStore FindDataStore(name DataStoreTag, optional LocalPlayer PlayerOwner);

// Export UDataStoreClient::execCreateDataStore(FFrame&, void* const)
native final function UIDataStore CreateDataStore(class<UIDataStore> DataStoreClass);

// Export UDataStoreClient::execRegisterDataStore(FFrame&, void* const)
native final function bool RegisterDataStore(UIDataStore DataStore, optional LocalPlayer PlayerOwner);

// Export UDataStoreClient::execUnregisterDataStore(FFrame&, void* const)
native final function bool UnregisterDataStore(UIDataStore DataStore);

// Export UDataStoreClient::execFindPlayerDataStoreIndex(FFrame&, void* const)
native final function int FindPlayerDataStoreIndex(LocalPlayer PlayerOwner);

final function GetPlayerDataStoreClasses(out array< class<UIDataStore> > out_DataStoreClasses)
{
    out_DataStoreClasses = PlayerDataStoreClasses;
}

final function class<UIDataStore> FindDataStoreClass(class<UIDataStore> RequiredMetaClass)
{
    local int I;
    local class<UIDataStore> Result;

    I = 0;
    J0x0B:

    if(I < GlobalDataStores.Length)
    {
        if(GlobalDataStores[I].IsA(RequiredMetaClass.Name))
        {
            Result = GlobalDataStores[I].Class;
            goto J0xA8;
        }
        ++ I;
        goto J0x0B;
    }
    J0xA8:

    if(Result == none)
    {
        I = 0;
        J0xC2:

        if(I < PlayerDataStoreClasses.Length)
        {
            if(ClassIsChildOf(PlayerDataStoreClasses[I], RequiredMetaClass))
            {
                Result = PlayerDataStoreClasses[I];
                goto J0x12A;
            }
            ++ I;
            goto J0xC2;
        }
    }
    J0x12A:

    return Result;
}

final event NotifyGameSessionEnded()
{
    local int I, DataStoreIndex;
    local array<UIDataStore> DataStoreArray;

    DataStoreArray = GlobalDataStores;
    DataStoreIndex = 0;
    J0x1E:

    if(DataStoreIndex < DataStoreArray.Length)
    {
        if(DataStoreArray[DataStoreIndex].NotifyGameSessionEnded())
        {
            UnregisterDataStore(DataStoreArray[DataStoreIndex]);
        }
        ++ DataStoreIndex;
        goto J0x1E;
    }
    I = PlayerDataStores.Length - 1;
    J0xA4:

    if(I >= 0)
    {
        DataStoreArray = PlayerDataStores[I].DataStores;
        DataStoreIndex = 0;
        J0xEE:

        if(DataStoreIndex < DataStoreArray.Length)
        {
            DataStoreArray[DataStoreIndex].NotifyGameSessionEnded();
            UnregisterDataStore(DataStoreArray[DataStoreIndex]);
            ++ DataStoreIndex;
            goto J0xEE;
        }
        -- I;
        goto J0xA4;
    }
}

final function DebugDumpDataStoreInfo(bool bVerbose)
{
    local int DataStoreIndex, PlayerDataStoreIndex;
    local string PlayerName;
    local LocalPlayer PlayerOwner;
    local array<UIDataStore> PlayerGroupDataStores;

    LogInternal("GlobalDataStores: " $ string(GlobalDataStores.Length), 'DevDataStore');
    DataStoreIndex = 0;
    J0x38:

    if(DataStoreIndex < GlobalDataStores.Length)
    {
        LogInternal(((((("	GlobalDataStore[" $ string(DataStoreIndex)) $ "]:") @ string(GlobalDataStores[DataStoreIndex].Tag)) @ "(") $ string(GlobalDataStores[DataStoreIndex])) $ ")", 'DevDataStore');
        ++ DataStoreIndex;
        goto J0x38;
    }
    LogInternal("");
    LogInternal("Player data store groups:" $ string(PlayerDataStores.Length), 'DevDataStore');
    DataStoreIndex = 0;
    J0x120:

    if(DataStoreIndex < PlayerDataStores.Length)
    {
        PlayerOwner = PlayerDataStores[DataStoreIndex].PlayerOwner;
        PlayerGroupDataStores = PlayerDataStores[DataStoreIndex].DataStores;
        PlayerName = ((((PlayerOwner != none) && PlayerOwner.Actor != none) && PlayerOwner.Actor.PlayerReplicationInfo != none) ? PlayerOwner.Actor.PlayerReplicationInfo.PlayerName : "None");
        LogInternal(((((((("	PlayerDataStores for player " $ string(DataStoreIndex)) $ ":") @ string(PlayerGroupDataStores.Length)) @ "(") $ PlayerName) @ "-") @ string(PlayerOwner)) $ ")", 'DevDataStore');
        PlayerDataStoreIndex = 0;
        J0x2DE:

        if(PlayerDataStoreIndex < PlayerGroupDataStores.Length)
        {
            LogInternal(((((("		PlayerDataStore[" $ string(PlayerDataStoreIndex)) $ "]:") @ string(PlayerGroupDataStores[PlayerDataStoreIndex].Tag)) @ "(") $ string(PlayerGroupDataStores[PlayerDataStoreIndex])) $ ")", 'DevDataStore');
            ++ PlayerDataStoreIndex;
            goto J0x2DE;
        }
        ++ DataStoreIndex;
        goto J0x120;
    }
}

defaultproperties
{
    GlobalDataStoreClasses(0)="Engine.UIDataStore_Fonts"
    GlobalDataStoreClasses(1)="Engine.UIDataStore_Registry"
    GlobalDataStoreClasses(2)="Engine.UIDataStore_InputAlias"
    GlobalDataStoreClasses(3)="KFGame.KFUIDataStore_GameResource"
    GlobalDataStoreClasses(4)="KFGame.KFDataStore_OnlineGameSearch"
    PlayerDataStoreClassNames(0)="Engine.UIDataStore_OnlinePlayerData"
}