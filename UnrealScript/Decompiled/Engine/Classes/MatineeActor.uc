/*******************************************************************************
 * MatineeActor generated by Eliot.UELib using UE Explorer.
 * Eliot.UELib ? 2009-2022 Eliot van Uytfanghe. All rights reserved.
 * http://eliotvu.com
 *
 * All rights belong to their respective owners.
 *******************************************************************************/
class MatineeActor extends Actor
    native
    nativereplication
    notplaceable
    hidecategories(Navigation);

const MAX_AIGROUP_NUMBER = 10;

var const SeqAct_Interp InterpAction;
var bool bIsPlaying;
var bool bReversePlayback;
var bool bPaused;
var transient bool AllAIGroupsInitialized;
var float PlayRate;
var float Position;
var name AIGroupNames[10];
var Pawn AIGroupPawns[10];
var transient int AIGroupInitStage[10];
var float ClientSidePositionErrorTolerance;

replication
{
     if(bNetInitial && Role == ROLE_Authority)
        InterpAction;

     if(bNetDirty && Role == ROLE_Authority)
        AIGroupNames, AIGroupPawns, 
        PlayRate, Position, 
        bIsPlaying, bPaused, 
        bReversePlayback;
}

// Export UMatineeActor::execAddAIGroupActor(FFrame&, void* const)
native function AddAIGroupActor(InterpGroupInstAI AIGroupInst);

event Update()
{
    local InterpGroupInstAI AIGroupInst;
    local int GroupID;

    bIsPlaying = InterpAction.bIsPlaying;
    bReversePlayback = InterpAction.bReversePlayback;
    bPaused = InterpAction.bPaused;
    PlayRate = InterpAction.PlayRate;
    Position = InterpAction.Position;
    bForceNetUpdate = true;
    if(bIsPlaying)
    {
        SetTimer(1, true, 'CheckPriorityRefresh');        
    }
    else
    {
        ClearTimer('CheckPriorityRefresh');
    }
    if(InterpAction != none)
    {
        GroupID = 0;
        J0x12B:

        if(GroupID < InterpAction.GroupInst.Length)
        {
            AIGroupInst = InterpGroupInstAI(InterpAction.GroupInst[GroupID]);
            if(AIGroupInst != none)
            {
                AddAIGroupActor(AIGroupInst);
            }
            ++ GroupID;
            goto J0x12B;
        }
    }
}

function CheckPriorityRefresh()
{
    local Controller C;
    local int I;

    if(InterpAction != none)
    {
        I = 0;
        J0x1A:

        if(I < InterpAction.GroupInst.Length)
        {
            if(InterpGroupInstDirector(InterpAction.GroupInst[I]) != none)
            {
                bNetDirty = true;
                bForceNetUpdate = true;
                return;
            }
            ++ I;
            goto J0x1A;
        }
        foreach WorldInfo.AllControllers(Class'Controller', C)
        {
            if((C.bIsPlayer && C.Pawn != none) && (InterpAction.LatentActors.Find(C.Pawn != -1) || (C.Pawn.Base != none) && InterpAction.LatentActors.Find(C.Pawn.Base != -1)
            {
                bNetDirty = true;
                bForceNetUpdate = true;                
                return;
            }            
        }        
    }
}

defaultproperties
{
    PlayRate=1
    Position=-1
    ClientSidePositionErrorTolerance=0.1
    begin object name=Sprite class=SpriteComponent
        SpriteCategoryName=Matinee
        ReplacementPrimitive=none
        HiddenGame=true
        AlwaysLoadOnClient=false
        AlwaysLoadOnServer=false
    object end
    // Reference: SpriteComponent'Default__MatineeActor.Sprite'
    Components(0)=Sprite
    RemoteRole=ENetRole.ROLE_SimulatedProxy
    CollisionType=ECollisionType.COLLIDE_CustomDefault
    bAlwaysRelevant=true
    bReplicateMovement=false
    bSkipActorPropertyReplication=true
    bOnlyDirtyReplication=true
    NetUpdateFrequency=1
    NetPriority=2.7
}