/*******************************************************************************
 * McpGroupsManager generated by Eliot.UELib using UE Explorer.
 * Eliot.UELib ? 2009-2022 Eliot van Uytfanghe. All rights reserved.
 * http://eliotvu.com
 *
 * All rights belong to their respective owners.
 *******************************************************************************/
class McpGroupsManager extends McpGroupsBase
    config(Engine);

var config string CreateGroupUrl;
var config string DeleteGroupUrl;
var config string QueryGroupsUrl;
var config string QueryGroupMembersUrl;
var config string AddGroupMembersUrl;
var config string RemoveGroupMembersUrl;
var config string DeleteAllGroupsUrl;
var config string AcceptGroupInviteUrl;
var config string RejectGroupInviteUrl;
var delegate<OnQueryGroupsRequestComplete> __OnQueryGroupsRequestComplete__Delegate;
var delegate<OnQueryGroupMembersRequestComplete> __OnQueryGroupMembersRequestComplete__Delegate;
var delegate<OnAddGroupMembersRequestComplete> __OnAddGroupMembersRequestComplete__Delegate;
var delegate<OnAcceptGroupInviteRequestComplete> __OnAcceptGroupInviteRequestComplete__Delegate;

function CreateGroup(string UniqueUserId, string GroupName)
{
    local string URL;
    local HttpRequestInterface CreateGroupRequest;
    local McpGroup FailedGroup;

    if((Len(UniqueUserId) > 0) && Len(GroupName) > 0)
    {
        CreateGroupRequest = Class'HttpFactory'.static.CreateRequest();
        if(CreateGroupRequest != none)
        {
            URL = ((((((((GetBaseURL()) $ CreateGroupUrl) $ (GetAppAccessURL())) $ "&uniqueUserId=") $ UniqueUserId) $ "&groupName=") $ GroupName) $ "&accessLevel=") $ "OWNER";
            CreateGroupRequest.SetURL(URL);
            CreateGroupRequest.SetVerb("POST");
            CreateGroupRequest.__OnProcessRequestComplete__Delegate = OnCreateGroupRequestComplete;
            if(!CreateGroupRequest.ProcessRequest())
            {
                LogInternal(((((((("(" $ string(Name)) $ ") McpGroupsManager::") $ string(GetStateName())) $ ":") $ string(GetFuncName())) @ "Failed to process web request for URL(") $ URL) $ ")");
            }
            LogInternal((((((("(" $ string(Name)) $ ") McpGroupsManager::") $ string(GetStateName())) $ ":") $ string(GetFuncName())) $ " URL is ") $ URL);            
        }
        else
        {
            OnCreateGroupComplete(FailedGroup, false, "HttpRequest was not be created");
        }        
    }
    else
    {
        OnCreateGroupComplete(FailedGroup, false, "UserId or GroupName wasn't specified");
    }
}

function OnCreateGroupRequestComplete(HttpRequestInterface CreateGroupRequest, HttpResponseInterface HttpResponse, bool bWasSuccessful)
{
    local int ResponseCode;
    local string Content;
    local McpGroup CreatedGroup;
    local string JsonString;
    local JsonObject ParsedJson;

    ResponseCode = 500;
    if((HttpResponse != none) && CreateGroupRequest != none)
    {
        ResponseCode = HttpResponse.GetResponseCode();
        bWasSuccessful = bWasSuccessful && ResponseCode == 201;
        Content = HttpResponse.GetContentAsString();
        CreatedGroup.OwnerId = CreateGroupRequest.GetURLParameter("uniqueUserId");
        CreatedGroup.GroupName = CreateGroupRequest.GetURLParameter("groupName");
        JsonString = HttpResponse.GetContentAsString();
        if((JsonString != "") && bWasSuccessful)
        {
            ParsedJson = Class'JsonObject'.static.DecodeJson(JsonString);
            CreatedGroup.GroupID = ParsedJson.GetStringValue("group_id");
            CreatedGroup.OwnerId = ParsedJson.GetStringValue("unique_user_id");
            CreatedGroup.GroupName = ParsedJson.GetStringValue("group_name");
            CreatedGroup.AccessLevel = byte(ParsedJson.GetIntValue("access_level"));            
        }
        else
        {
            LogInternal(((((("(" $ string(Name)) $ ") McpGroupsManager::") $ string(GetStateName())) $ ":") $ string(GetFuncName())) @ " CreateGroup query did not return a group.");
        }
    }
    OnCreateGroupComplete(CreatedGroup, bWasSuccessful, Content);
}

function DeleteGroup(string UniqueUserId, string GroupID)
{
    local string URL;
    local HttpRequestInterface DeleteGroupRequest;

    if((Len(UniqueUserId) > 0) && Len(GroupID) > 0)
    {
        DeleteGroupRequest = Class'HttpFactory'.static.CreateRequest();
        if(DeleteGroupRequest != none)
        {
            URL = ((((((GetBaseURL()) $ DeleteGroupUrl) $ (GetAppAccessURL())) $ "&uniqueUserId=") $ UniqueUserId) $ "&groupId=") $ GroupID;
            DeleteGroupRequest.SetVerb("DELETE");
            DeleteGroupRequest.SetURL(URL);
            DeleteGroupRequest.__OnProcessRequestComplete__Delegate = OnDeleteGroupRequestComplete;
            if(!DeleteGroupRequest.ProcessRequest())
            {
                LogInternal(((((((("(" $ string(Name)) $ ") McpGroupsManager::") $ string(GetStateName())) $ ":") $ string(GetFuncName())) @ "Failed to process web request for URL(") $ URL) $ ")");
            }
            LogInternal((((((("(" $ string(Name)) $ ") McpGroupsManager::") $ string(GetStateName())) $ ":") $ string(GetFuncName())) $ "URL is ") $ URL);            
        }
        else
        {
            OnDeleteGroupComplete(GroupID, false, "HttpRequest could not be completed");
        }        
    }
    else
    {
        OnDeleteGroupComplete(GroupID, false, "UniqueUserId and/or GroupId was not specified");
    }
}

function OnDeleteGroupRequestComplete(HttpRequestInterface OriginalRequest, HttpResponseInterface HttpResponse, bool bWasSuccessful)
{
    local int ResponseCode;
    local string Content, GroupID;

    ResponseCode = 500;
    if(HttpResponse != none)
    {
        ResponseCode = HttpResponse.GetResponseCode();
        GroupID = HttpResponse.GetURLParameter("GroupId");
        ResponseCode = HttpResponse.GetResponseCode();
        Content = HttpResponse.GetContentAsString();
    }
    bWasSuccessful = bWasSuccessful && ResponseCode == 200;
    OnDeleteGroupComplete(GroupID, bWasSuccessful, Content);
}

function QueryGroups(string RequesterId)
{
    local string URL;
    local HttpRequestInterface QueryGroupsRequest;

    if(Len(RequesterId) > 0)
    {
        QueryGroupsRequest = Class'HttpFactory'.static.CreateRequest();
        if(QueryGroupsRequest != none)
        {
            URL = ((((GetBaseURL()) $ QueryGroupsUrl) $ (GetAppAccessURL())) $ "&memberUniqueUserId=") $ RequesterId;
            QueryGroupsRequest.SetURL(URL);
            QueryGroupsRequest.SetVerb("GET");
            QueryGroupsRequest.__OnProcessRequestComplete__Delegate = OnQueryGroupsRequestComplete;
            if(!QueryGroupsRequest.ProcessRequest())
            {
                LogInternal(((((((("(" $ string(Name)) $ ") McpGroupsManager::") $ string(GetStateName())) $ ":") $ string(GetFuncName())) @ "Failed to process web request for URL(") $ URL) $ ")");
            }            
        }
        else
        {
            OnQueryGroupsComplete(RequesterId, false, "Http Request could not be created");
        }        
    }
    else
    {
        OnQueryGroupsComplete(RequesterId, false, "RequesterId was not specified");
    }
}

delegate OnQueryGroupsRequestComplete(HttpRequestInterface OriginalRequest, HttpResponseInterface HttpResponse, bool bWasSuccessful)
{
    local int ResponseCode;
    local string Error;
    local McpGroup Group;
    local string JsonString;
    local JsonObject ParsedJson;
    local int JsonIndex;
    local string RequesterId;

    ResponseCode = 500;
    if((HttpResponse != none) && OriginalRequest != none)
    {
        RequesterId = OriginalRequest.GetURLParameter("memberUniqueUserId");
        ResponseCode = HttpResponse.GetResponseCode();
        bWasSuccessful = bWasSuccessful && ResponseCode == 200;
        if(bWasSuccessful)
        {
            JsonString = HttpResponse.GetContentAsString();
            if(JsonString != "")
            {
                ParsedJson = Class'JsonObject'.static.DecodeJson(JsonString);
                JsonIndex = 0;
                J0x13F:

                if(JsonIndex < ParsedJson.ObjectArray.Length)
                {
                    Group.OwnerId = ParsedJson.ObjectArray[JsonIndex].GetStringValue("unique_user_id");
                    Group.GroupID = ParsedJson.ObjectArray[JsonIndex].GetStringValue("group_id");
                    Group.GroupName = ParsedJson.ObjectArray[JsonIndex].GetStringValue("group_name");
                    Group.AccessLevel = byte(ParsedJson.ObjectArray[JsonIndex].GetIntValue("access_level"));
                    CacheGroup(RequesterId, Group);
                    ++ JsonIndex;
                    goto J0x13F;
                }                
            }
            else
            {
                Error = "Query did not return any content in it's response.";
                LogInternal(((((("(" $ string(Name)) $ ") McpGroupsManager::") $ string(GetStateName())) $ ":") $ string(GetFuncName())) $ Error);
            }            
        }
        else
        {
            Error = HttpResponse.GetContentAsString();
        }
    }
    OnQueryGroupsComplete(RequesterId, bWasSuccessful, Error);
}

function GetGroupList(string UserId, out McpGroupList GroupList)
{
    local int GroupListIndex;

    if(Len(UserId) > 0)
    {
        GroupListIndex = GroupLists.Find('RequesterId', UserId;
        if(GroupListIndex != -1)
        {
            GroupList = GroupLists[GroupListIndex];            
        }
        else
        {
            LogInternal((((((("(" $ string(Name)) $ ") McpGroupsManager::") $ string(GetStateName())) $ ":") $ string(GetFuncName())) $ " Requester Id not found or GroupLists is empty. Using UserId: ") $ UserId);
        }        
    }
    else
    {
        LogInternal(((((("(" $ string(Name)) $ ") McpGroupsManager::") $ string(GetStateName())) $ ":") $ string(GetFuncName())) $ "UserId not specified");
    }
}

function QueryGroupMembers(string UniqueUserId, string GroupID)
{
    local string URL;
    local HttpRequestInterface QueryGroupMembersRequest;

    if((Len(UniqueUserId) > 0) && Len(GroupID) > 0)
    {
        QueryGroupMembersRequest = Class'HttpFactory'.static.CreateRequest();
        if(QueryGroupMembersRequest != none)
        {
            URL = ((((GetBaseURL()) $ QueryGroupMembersUrl) $ (GetAppAccessURL())) $ "&groupId=") $ GroupID;
            QueryGroupMembersRequest.SetURL(URL);
            QueryGroupMembersRequest.SetVerb("GET");
            QueryGroupMembersRequest.__OnProcessRequestComplete__Delegate = OnQueryGroupMembersRequestComplete;
            if(!QueryGroupMembersRequest.ProcessRequest())
            {
                LogInternal(((((((("(" $ string(Name)) $ ") McpGroupsManager::") $ string(GetStateName())) $ ":") $ string(GetFuncName())) @ "Failed to process web request for URL(") $ URL) $ ")");
            }            
        }
        else
        {
            OnQueryGroupMembersComplete(GroupID, false, "HttpRequest not created");
        }        
    }
    else
    {
        OnQueryGroupMembersComplete(GroupID, false, "UserId and/or GroupId not specified");
    }
}

delegate OnQueryGroupMembersRequestComplete(HttpRequestInterface OriginalRequest, HttpResponseInterface HttpResponse, bool bWasSuccessful)
{
    local int ResponseCode;
    local string Error, JsonString;
    local JsonObject ParsedJson;
    local int JsonIndex;
    local McpGroupsBase.EMcpGroupAcceptState AcceptState;
    local string MemberId, GroupID;

    ResponseCode = 500;
    if((HttpResponse != none) && OriginalRequest != none)
    {
        ResponseCode = HttpResponse.GetResponseCode();
        bWasSuccessful = bWasSuccessful && ResponseCode == 200;
        if(bWasSuccessful)
        {
            JsonString = HttpResponse.GetContentAsString();
            if(JsonString != "")
            {
                ParsedJson = Class'JsonObject'.static.DecodeJson(JsonString);
                JsonIndex = 0;
                J0x102:

                if(JsonIndex < ParsedJson.ObjectArray.Length)
                {
                    MemberId = ParsedJson.ObjectArray[JsonIndex].GetStringValue("unique_user_id");
                    GroupID = ParsedJson.ObjectArray[JsonIndex].GetStringValue("group_id");
                    AcceptState = byte(ParsedJson.ObjectArray[JsonIndex].GetIntValue("status"));
                    CacheGroupMember(MemberId, GroupID, AcceptState);
                    ++ JsonIndex;
                    goto J0x102;
                }                
            }
            else
            {
                Error = "Query did not return any content in it's response.";
                LogInternal(((((("(" $ string(Name)) $ ") McpGroupsManager::") $ string(GetStateName())) $ ":") $ string(GetFuncName())) $ Error);
            }            
        }
        else
        {
            Error = HttpResponse.GetContentAsString();
        }
    }
    OnQueryGroupMembersComplete(GroupID, bWasSuccessful, Error);
}

function GetGroupMembers(string GroupID, out array<McpGroupMember> GroupMembers)
{
    local int GroupIndex;
    local McpGroupList GroupList;
    local McpGroup GroupTemp;

    foreach GroupLists(GroupList,)
    {
        foreach GroupList.Groups(GroupTemp, GroupIndex)
        {
            if(GroupTemp.GroupID == GroupID)
            {
                GroupMembers = GroupTemp.Members;
            }            
        }                
    }    
}

function AddGroupMembers(string UniqueUserId, string GroupID, const out array<string> MemberIds, bool bRequiresAcceptance)
{
    local string URL;
    local HttpRequestInterface AddGroupMembersRequest;
    local string JsonPayload;
    local int Index;

    if((Len(UniqueUserId) > 0) && Len(GroupID) > 0)
    {
        AddGroupMembersRequest = Class'HttpFactory'.static.CreateRequest();
        AddGroupMembersRequest.__OnProcessRequestComplete__Delegate = OnAddGroupMembersRequestComplete;
        if(AddGroupMembersRequest != none)
        {
            URL = ((((((((GetBaseURL()) $ AddGroupMembersUrl) $ (GetAppAccessURL())) $ "&uniqueUserId=") $ UniqueUserId) $ "&groupId=") $ GroupID) $ "&requiresAcceptance=") $ ((bRequiresAcceptance) ? "true" : "false");
            if(MemberIds.Length > 0)
            {
                JsonPayload = "[ ";
                Index = 0;
                J0x14B:

                if(Index < MemberIds.Length)
                {                    
                    JsonPayload $= (("\"" $ MemberIds[Index]) $ "\"");
                    if((Index + 1) < MemberIds.Length)
                    {                        
                        JsonPayload $= ",";
                    }
                    ++ Index;
                    goto J0x14B;
                }                
                JsonPayload $= " ]";
                AddGroupMembersRequest.SetVerb("POST");
                AddGroupMembersRequest.SetContentAsString(JsonPayload);
                AddGroupMembersRequest.SetURL(URL);
                if(!AddGroupMembersRequest.ProcessRequest())
                {
                    LogInternal(((((((("(" $ string(Name)) $ ") McpGroupsManager::") $ string(GetStateName())) $ ":") $ string(GetFuncName())) @ "Failed to process web request for URL(") $ URL) $ ")");
                }
                LogInternal(((((((("(" $ string(Name)) $ ") McpGroupsManager::") $ string(GetStateName())) $ ":") $ string(GetFuncName())) @ "URL(") $ URL) $ ")");                
            }
            else
            {
                LogInternal(((((("(" $ string(Name)) $ ") McpGroupsManager::") $ string(GetStateName())) $ ":") $ string(GetFuncName())) @ " No MemberIds given.");
            }            
        }
        else
        {
            OnAddGroupMembersComplete(GroupID, false, "HttpRequest was not created");
        }        
    }
    else
    {
        OnAddGroupMembersComplete(GroupID, false, "UserId and/or GroupId not specified");
    }
}

delegate OnAddGroupMembersRequestComplete(HttpRequestInterface OriginalRequest, HttpResponseInterface HttpResponse, bool bWasSuccessful)
{
    local int ResponseCode;
    local string Content, GroupID;

    ResponseCode = 500;
    if(HttpResponse != none)
    {
        GroupID = HttpResponse.GetURLParameter("GroupId");
        ResponseCode = HttpResponse.GetResponseCode();
        Content = HttpResponse.GetContentAsString();
    }
    bWasSuccessful = bWasSuccessful && ResponseCode == 200;
    OnAddGroupMembersComplete(GroupID, bWasSuccessful, Content);
}

function RemoveGroupMembers(string UniqueUserId, string GroupID, const out array<string> MemberIds)
{
    local string URL;
    local HttpRequestInterface RemoveGroupMembersRequest;
    local string JsonPayload;
    local int Index;

    if((Len(UniqueUserId) > 0) && Len(GroupID) > 0)
    {
        RemoveGroupMembersRequest = Class'HttpFactory'.static.CreateRequest();
        if(RemoveGroupMembersRequest != none)
        {
            URL = ((((GetBaseURL()) $ RemoveGroupMembersUrl) $ (GetAppAccessURL())) $ "&groupId=") $ GroupID;
            if(MemberIds.Length > 0)
            {
                JsonPayload = "[ ";
                Index = 0;
                J0xC8:

                if(Index < MemberIds.Length)
                {                    
                    JsonPayload $= (("\"" $ MemberIds[Index]) $ "\"");
                    if((Index + 1) < MemberIds.Length)
                    {                        
                        JsonPayload $= ",";
                    }
                    ++ Index;
                    goto J0xC8;
                }                
                JsonPayload $= " ]";
                RemoveGroupMembersRequest.SetURL(URL);
                RemoveGroupMembersRequest.SetContentAsString(JsonPayload);
                RemoveGroupMembersRequest.SetVerb("DELETE");
                RemoveGroupMembersRequest.__OnProcessRequestComplete__Delegate = OnRemoveGroupMembersRequestComplete;
                if(!RemoveGroupMembersRequest.ProcessRequest())
                {
                    LogInternal(((((((("(" $ string(Name)) $ ") McpGroupsManager::") $ string(GetStateName())) $ ":") $ string(GetFuncName())) @ "Failed to process web request for URL(") $ URL) $ ")");
                }                
            }
            else
            {
                LogInternal(((((("(" $ string(Name)) $ ") McpGroupsManager::") $ string(GetStateName())) $ ":") $ string(GetFuncName())) @ " No MemberIds given.");
            }            
        }
        else
        {
            OnRemoveGroupMembersComplete(GroupID, false, "Http request was not created");
        }        
    }
    else
    {
        OnRemoveGroupMembersComplete(GroupID, false, "UniqueUserId and/or GroupId was not specified");
    }
}

function OnRemoveGroupMembersRequestComplete(HttpRequestInterface OriginalRequest, HttpResponseInterface HttpResponse, bool bWasSuccessful)
{
    local int ResponseCode;
    local string Content, GroupID;

    ResponseCode = 500;
    if(HttpResponse != none)
    {
        GroupID = HttpResponse.GetURLParameter("GroupId");
        ResponseCode = HttpResponse.GetResponseCode();
        Content = HttpResponse.GetContentAsString();
    }
    bWasSuccessful = bWasSuccessful && ResponseCode == 200;
    OnRemoveGroupMembersComplete(GroupID, bWasSuccessful, Content);
}

function DeleteAllGroups(string UniqueUserId)
{
    local string URL;
    local HttpRequestInterface DeleteGroupRequest;

    if(Len(UniqueUserId) > 0)
    {
        DeleteGroupRequest = Class'HttpFactory'.static.CreateRequest();
        if(DeleteGroupRequest != none)
        {
            DeleteGroupRequest.SetVerb("DELETE");
            URL = ((((GetBaseURL()) $ DeleteAllGroupsUrl) $ (GetAppAccessURL())) $ "&uniqueUserId=") $ UniqueUserId;
            DeleteGroupRequest.SetURL(URL);
            LogInternal("URL=" @ DeleteGroupRequest.GetURL());
            DeleteGroupRequest.__OnProcessRequestComplete__Delegate = OnDeleteGroupRequestComplete;
            if(!DeleteGroupRequest.ProcessRequest())
            {
                LogInternal(((((((("(" $ string(Name)) $ ") McpGroupsManager::") $ string(GetStateName())) $ ":") $ string(GetFuncName())) @ "Failed to process web request for URL(") $ URL) $ ")");
            }            
        }
        else
        {
            OnDeleteAllGroupsComplete(UniqueUserId, false, "HttpRequest was not created");
        }        
    }
    else
    {
        OnDeleteAllGroupsComplete(UniqueUserId, false, "UniqueUserId was not specified");
    }
}

function OnDeleteAllGroupsRequestComplete(HttpRequestInterface OriginalRequest, HttpResponseInterface HttpResponse, bool bWasSuccessful)
{
    local int ResponseCode;
    local string Content, RequesterId;

    ResponseCode = 500;
    if((HttpResponse != none) && OriginalRequest != none)
    {
        RequesterId = OriginalRequest.GetURLParameter("uniqueUserId");
        ResponseCode = HttpResponse.GetResponseCode();
        Content = HttpResponse.GetContentAsString();
    }
    bWasSuccessful = bWasSuccessful && ResponseCode == 200;
    OnDeleteAllGroupsComplete(RequesterId, bWasSuccessful, Content);
}

function AcceptGroupInvite(string UniqueUserId, string GroupID, bool bShouldAccept)
{
    local string URL;
    local HttpRequestInterface AcceptGroupInviteRequest;

    if((Len(UniqueUserId) > 0) && Len(GroupID) > 0)
    {
        AcceptGroupInviteRequest = Class'HttpFactory'.static.CreateRequest();
        if(AcceptGroupInviteRequest != none)
        {
            URL = ((((((((GetBaseURL()) $ AcceptGroupInviteUrl) $ (GetAppAccessURL())) $ "&uniqueUserId=") $ UniqueUserId) $ "&groupId=") $ GroupID) $ "&status=") $ ((bShouldAccept) ? "accepted" : "rejected");
            AcceptGroupInviteRequest.SetVerb("POST");
            AcceptGroupInviteRequest.SetURL(URL);
            AcceptGroupInviteRequest.__OnProcessRequestComplete__Delegate = OnAcceptGroupInviteRequestComplete;
            LogInternal("Calling Process Request");
            if(!AcceptGroupInviteRequest.ProcessRequest())
            {
                LogInternal(((((((("(" $ string(Name)) $ ") McpGroupsManager::") $ string(GetStateName())) $ ":") $ string(GetFuncName())) @ "Failed to process web request for URL(") $ URL) $ ")");
            }            
        }
        else
        {
            OnAcceptGroupInviteComplete(GroupID, false, "HttpRequest not created");
        }        
    }
    else
    {
        OnAcceptGroupInviteComplete(GroupID, false, "UniqueUserId or GroupId was not specified");
    }
}

delegate OnAcceptGroupInviteRequestComplete(HttpRequestInterface OriginalRequest, HttpResponseInterface HttpResponse, bool bWasSuccessful)
{
    local int ResponseCode;
    local string Content, GroupID;

    ResponseCode = 500;
    if(HttpResponse != none)
    {
        GroupID = HttpResponse.GetURLParameter("GroupId");
        ResponseCode = HttpResponse.GetResponseCode();
        Content = HttpResponse.GetContentAsString();
    }
    bWasSuccessful = bWasSuccessful && ResponseCode == 200;
    OnAcceptGroupInviteComplete(GroupID, bWasSuccessful, Content);
}

function CacheGroup(string RequesterId, McpGroup Group)
{
    local int AddAt, GroupIndex, GroupListIndex;
    local McpGroupList UserGroupList;
    local bool bWasFound;

    bWasFound = false;
    GroupListIndex = GroupLists.Find('RequesterId', RequesterId;
    if(GroupListIndex != -1)
    {
        UserGroupList = GroupLists[GroupListIndex];
        GroupIndex = 0;
        J0x70:

        if((GroupIndex < UserGroupList.Groups.Length) && !bWasFound)
        {
            bWasFound = Group.GroupID == UserGroupList.Groups[GroupIndex].GroupID;
            ++ GroupIndex;
            goto J0x70;
        }
        if(!bWasFound)
        {
            AddAt = UserGroupList.Groups.Length;
            UserGroupList.Groups.Length = AddAt + 1;
            UserGroupList.Groups[AddAt] = Group;
            GroupLists[GroupListIndex] = UserGroupList;
        }
        LogInternal((((((("(" $ string(Name)) $ ") McpGroupsManager::") $ string(GetStateName())) $ ":") $ string(GetFuncName())) $ " GroupName: ") $ UserGroupList.Groups[AddAt].GroupName);        
    }
    else
    {
        AddAt = GroupLists.Length;
        GroupLists.Length = AddAt + 1;
        GroupLists[AddAt].RequesterId = Group.OwnerId;
        GroupLists[AddAt].Groups[0] = Group;
    }
}

function CacheGroupMember(string MemberId, string GroupID, McpGroupsBase.EMcpGroupAcceptState AcceptState)
{
    local int MemberIndex;
    local McpGroupList GroupList;
    local int GroupListIndex;
    local McpGroup GroupTemp;
    local int GroupIndex, AddAt;

    if(((Len(MemberId) > 0) && Len(GroupID) > 0) && Len(string(AcceptState)) > 0)
    {
        foreach GroupLists(GroupList, GroupListIndex)
        {
            foreach GroupList.Groups(GroupTemp, GroupIndex)
            {
                if(GroupTemp.GroupID == GroupID)
                {
                    MemberIndex = GroupTemp.Members.Find('MemberId', MemberId;
                    if(MemberIndex == -1)
                    {
                        AddAt = GroupTemp.Members.Length;
                        GroupTemp.Members.Length = AddAt + 1;
                        GroupTemp.Members[AddAt].MemberId = MemberId;
                        GroupTemp.Members[AddAt].AcceptState = AcceptState;                        
                    }
                    else
                    {
                        if(GroupTemp.Members[MemberIndex].AcceptState != AcceptState)
                        {
                            GroupTemp.Members[MemberIndex].AcceptState = AcceptState;
                        }
                    }
                    GroupList.Groups[GroupIndex] = GroupTemp;
                }                
            }            
            GroupLists[GroupListIndex] = GroupList;            
        }                
    }
    else
    {
        LogInternal(((((("(" $ string(Name)) $ ") McpGroupsManager::") $ string(GetStateName())) $ ":") $ string(GetFuncName())) @ " Either the MemberId, GroupId, or AcceptState was not Specified.");
    }
}

defaultproperties
{
    CreateGroupUrl="/groupcreate"
    DeleteGroupUrl="/groupdelete"
    QueryGroupsUrl="/grouplist"
    QueryGroupMembersUrl="/groupmembers"
    AddGroupMembersUrl="/groupmembers"
    RemoveGroupMembersUrl="/groupmembers"
    DeleteAllGroupsUrl="/groupdeletebyownerid"
    AcceptGroupInviteUrl="/groupinvite"
    RejectGroupInviteUrl="/groupinvite"
}