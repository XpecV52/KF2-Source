/*******************************************************************************
 * KFProj_MolotovSplash generated by Eliot.UELib using UE Explorer.
 * Eliot.UELib ? 2009-2022 Eliot van Uytfanghe. All rights reserved.
 * http://eliotvu.com
 *
 * All rights belong to their respective owners.
 *******************************************************************************/
class KFProj_MolotovSplash extends KFProjectile
    hidecategories(Navigation);

simulated event HitWall(Vector HitNormal, Actor Wall, PrimitiveComponent WallComp)
{
    if((StaticMeshComponent(WallComp) != none) && StaticMeshComponent(WallComp).CanBecomeDynamic())
    {
        return;
    }
    Explode(Location, HitNormal);
}

simulated function ProcessTouch(Actor Other, Vector HitLocation, Vector HitNormal)
{
    if(Other.bBlockActors)
    {
        if(Pawn(Other) != none)
        {
            return;
        }
        if((KFDestructibleActor(Other) != none) && KFDestructibleActor(Other).ReplicationMode == 2)
        {
            return;
        }
        Explode(Location, HitNormal);
    }
}

protected simulated function PrepareExplosionActor(GameExplosionActor GEA)
{
    local KFExplosion_Molotov KFEM;
    local Vector ExplosionDir;

    super.PrepareExplosionActor(GEA);
    GEA.SetLocation(Location + (vector(GEA.Rotation) * float(10)));
    KFEM = KFExplosion_Molotov(GEA);
    if(KFEM != none)
    {
        ExplosionDir = vector(KFEM.Rotation);
        if(ExplosionDir.Z < -0.95)
        {
            KFEM.LoopingParticleEffect = KFEM.default.LoopingParticleEffectCeiling;            
        }
        else
        {
            if(ExplosionDir.Z < 0.05)
            {
                KFEM.LoopingParticleEffect = KFEM.default.LoopingParticleEffectWall;
            }
        }
    }
}

simulated function PostBeginPlay()
{
    local KFPlayerReplicationInfo InstigatorPRI;

    if((AltExploEffects != none) && Instigator != none)
    {
        InstigatorPRI = KFPlayerReplicationInfo(Instigator.PlayerReplicationInfo);
        if(InstigatorPRI != none)
        {
            bAltExploEffects = InstigatorPRI.bSplashActive;
        }        
    }
    else
    {
        bAltExploEffects = false;
    }
    super.PostBeginPlay();
}

protected simulated function PrepareExplosionTemplate()
{
    ExplosionTemplate.bIgnoreInstigator = true;
    super.PrepareExplosionTemplate();
    if(bAltExploEffects)
    {
        ExplosionTemplate.ExplosionEffects = AltExploEffects;
    }
}

defaultproperties
{
    bAlwaysReplicateExplosion=true
    bAutoStartAmbientSound=true
    AlwaysRelevantDistanceSquared=6250000
    ExplosionActorClass=Class'KFExplosion_Molotov'
    begin object name=ExploTemplate0 class=KFGameExplosion
        ExplosionEffects=KFImpactEffectInfo'wep_molotov_arch.Molotov_GroundFire'
        bDirectionalExplosion=true
        Damage=10
        DamageRadius=150
        MyDamageType=Class'KFDT_Fire_Ground_MolotovGrenade'
        KnockDownStrength=0
        MomentumTransferScale=1
        ExploLight=PointLightComponent'Default__KFProj_MolotovSplash.FlamePointLight'
        ExploLightFadeOutTime=0.3
        ExploLightStartFadeOutTime=4.2
        FractureMeshRadius=0
        CamShake=none
    object end
    // Reference: KFGameExplosion'Default__KFProj_MolotovSplash.ExploTemplate0'
    ExplosionTemplate=ExploTemplate0
    AltExploEffects=KFImpactEffectInfo'WEP_Flamethrower_ARCH.GroundFire_Splash_Impacts'
    ProjFlightTemplate=ParticleSystem'WEP_3P_Molotov_EMIT.FX_Molotov_Grenade_Spread_01'
    AmbientSoundPlayEvent=AkEvent'WW_WEP_SA_Flamethrower.Play_WEP_SA_Flamethrower_Residual_Fire_Loop'
    AmbientSoundStopEvent=AkEvent'WW_WEP_SA_Flamethrower.Stop_WEP_SA_Flamethrower_Residual_Fire_Loop'
    begin object name=AmbientAkSoundComponent class=AkComponent
        bStopWhenOwnerDestroyed=true
        bForceOcclusionUpdateInterval=true
        OcclusionUpdateInterval=0.25
    object end
    // Reference: AkComponent'Default__KFProj_MolotovSplash.AmbientAkSoundComponent'
    AmbientComponent=AmbientAkSoundComponent
    AssociatedPerkClass=Class'KFGame.KFPerk_Firebug'
    bBlockedByInstigator=false
    begin object name=CollisionCylinder class=CylinderComponent
        ReplacementPrimitive=none
    object end
    // Reference: CylinderComponent'Default__KFProj_MolotovSplash.CollisionCylinder'
    CylinderComponent=CollisionCylinder
    begin object name=CollisionCylinder class=CylinderComponent
        ReplacementPrimitive=none
    object end
    // Reference: CylinderComponent'Default__KFProj_MolotovSplash.CollisionCylinder'
    Components(0)=CollisionCylinder
    begin object name=AmbientAkSoundComponent class=AkComponent
        bStopWhenOwnerDestroyed=true
        bForceOcclusionUpdateInterval=true
        OcclusionUpdateInterval=0.25
    object end
    // Reference: AkComponent'Default__KFProj_MolotovSplash.AmbientAkSoundComponent'
    Components(1)=AmbientAkSoundComponent
    Physics=EPhysics.PHYS_Falling
    bNetTemporary=false
    bCollideComplex=true
    begin object name=CollisionCylinder class=CylinderComponent
        ReplacementPrimitive=none
    object end
    // Reference: CylinderComponent'Default__KFProj_MolotovSplash.CollisionCylinder'
    CollisionComponent=CollisionCylinder
}