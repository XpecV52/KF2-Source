/*******************************************************************************
 * KFAIController_ZedSiren generated by Eliot.UELib using UE Explorer.
 * Eliot.UELib ? 2009-2022 Eliot van Uytfanghe. All rights reserved.
 * http://eliotvu.com
 *
 * All rights belong to their respective owners.
 *******************************************************************************/
class KFAIController_ZedSiren extends KFAIController_Monster
    config(AI)
    hidecategories(Navigation);

function PreMoveToEnemy()
{
    if((MyKFPawn.SpecialMove == 17) || (MyKFPawn.SpecialMove == 0) && !IsTimerActive('DoScream'))
    {
        DoScream();
    }
}

function NotifySpecialMoveStarted(KFSpecialMove SM)
{
    if(IsInStumble() || MyKFPawn.IsIncapacitated())
    {
        AbortCommand(FindCommandOfClass(Class'AICommand_Siren_Scream'));
    }
}

function DoScream()
{
    if(IsInStumble() || MyKFPawn.IsIncapacitated())
    {
        return;
    }
    if((MyKFPawn.SpecialMove == 0) || MyKFPawn.SpecialMove == 17)
    {
        Class'AICommand_Siren_Scream'.static.Scream(self);
        MyKFPawn.DisablebOnDeathAchivement();
    }
}

function NotifySpecialMoveEnded(KFSpecialMove SM)
{
    local Pawn BestTarget;

    if((((SM.Handle == 'KFSM_Stumble') || SM.Handle == 'KFSM_Stunned') || SM.Handle == 'KFSM_Frozen') || SM.Handle == 'KFSM_RecoverFromRagdoll')
    {
        BestTarget = MyKFPawn.GetBestAggroEnemy();
        if(BestTarget != none)
        {
            BestTarget = GetClosestEnemy();
        }
        ChangeEnemy(BestTarget, true);
        SetEnemyMoveGoal(self, true);
        SetTimer(1, false, 'DoScream');
    }
}

function NotifyMeleeAttackFinished()
{
    if(MyKFPawn != none)
    {
        MyKFPawn.NotifyMeleeAttackFinished();
    }
}

function NotifyCommandFinished(AICommand FinishedCommand)
{
    if(ClassIsChildOf(FinishedCommand.Class, Class'AICommand_PanicWander'))
    {
        SetTimer(1, false, 'DoScream');
    }
    super(KFAIController).NotifyCommandFinished(FinishedCommand);
}

function EnterZedVictoryState()
{
    if(IsTimerActive('DoScream'))
    {
        ClearTimer('DoScream');
    }
    super(KFAIController).EnterZedVictoryState();
}

defaultproperties
{
    bIsProbingMeleeRangeEvents=true
    SprintWithinEnemyRange=(X=600,Y=1200)
    LowIntensityAttackCooldown=7
}