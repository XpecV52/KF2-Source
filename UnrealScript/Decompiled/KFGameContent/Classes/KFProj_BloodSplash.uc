/*******************************************************************************
 * KFProj_BloodSplash generated by Eliot.UELib using UE Explorer.
 * Eliot.UELib ? 2009-2022 Eliot van Uytfanghe. All rights reserved.
 * http://eliotvu.com
 *
 * All rights belong to their respective owners.
 *******************************************************************************/
class KFProj_BloodSplash extends KFProjectile
    hidecategories(Navigation);

var DecalMaterial ImpactDecalMaterial;
var float ImpactDecalMaxSize;
var float ImpactDecalMinSize;
var float ImpactDecalThickness;
var KFPawn BloodOriginPawn;

simulated event HitWall(Vector HitNormal, Actor Wall, PrimitiveComponent WallComp)
{
    if((StaticMeshComponent(WallComp) != none) && StaticMeshComponent(WallComp).CanBecomeDynamic())
    {
        return;
    }
    SpawnBloodDecal(Location, HitNormal);
}

simulated function ProcessTouch(Actor Other, Vector HitLocation, Vector HitNormal)
{
    if(Other.bBlockActors)
    {
        if(Pawn(Other) != none)
        {
            return;
        }
        if((KFDestructibleActor(Other) != none) && KFDestructibleActor(Other).ReplicationMode == 2)
        {
            return;
        }
        SpawnBloodDecal(Location, HitNormal);
    }
}

protected simulated function PrepareExplosionActor(GameExplosionActor GEA);

simulated function SpawnBloodDecal(Vector HitLocation, Vector HitNormal)
{
    local KFGoreManager GoreManager;

    GoreManager = KFGoreManager(WorldInfo.MyGoreEffectManager);
    if((GoreManager == none) || BloodOriginPawn == none)
    {
        return;
    }
    GoreManager.LeaveABloodSplatterDecal(BloodOriginPawn, HitLocation, Normal(Velocity));
    if(KFPawn_Monster(BloodOriginPawn) != none)
    {
        GoreManager.CausePersistentBlood(KFPawn_Monster(BloodOriginPawn), Class'KFDamageType', HitLocation, Normal(Velocity), 0, false, false);
    }
}

simulated function PostBeginPlay();

protected simulated function PrepareExplosionTemplate();

defaultproperties
{
    ImpactDecalMaterial=DecalMaterial'FX_Mat_Lib.FX_CH_BloodSplatter_DM'
    ImpactDecalMaxSize=125
    ImpactDecalMinSize=75
    ImpactDecalThickness=12
    bAlwaysReplicateExplosion=true
    AlwaysRelevantDistanceSquared=6250000
    bBlockedByInstigator=false
    begin object name=CollisionCylinder class=CylinderComponent
        ReplacementPrimitive=none
    object end
    // Reference: CylinderComponent'Default__KFProj_BloodSplash.CollisionCylinder'
    CylinderComponent=CollisionCylinder
    begin object name=CollisionCylinder class=CylinderComponent
        ReplacementPrimitive=none
    object end
    // Reference: CylinderComponent'Default__KFProj_BloodSplash.CollisionCylinder'
    Components(0)=CollisionCylinder
    Physics=EPhysics.PHYS_Falling
    bNetTemporary=false
    bCollideComplex=true
    begin object name=CollisionCylinder class=CylinderComponent
        ReplacementPrimitive=none
    object end
    // Reference: CylinderComponent'Default__KFProj_BloodSplash.CollisionCylinder'
    CollisionComponent=CollisionCylinder
}