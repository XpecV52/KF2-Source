/*******************************************************************************
 * KFPhysicsVolume generated by Eliot.UELib using UE Explorer.
 * Eliot.UELib ? 2009-2022 Eliot van Uytfanghe. All rights reserved.
 * http://eliotvu.com
 *
 * All rights belong to their respective owners.
 *******************************************************************************/
class KFPhysicsVolume extends PhysicsVolume
    hidecategories(Navigation,Object,Movement,Display);

struct TouchThrottling
{
    var Actor HitActor;
    var float HitTime;

    structdefaultproperties
    {
        HitActor=none
        HitTime=0
    }
};

var array<TouchThrottling> RecentUntouchEvents;
var() float ThrottleTime;

function CausePainTo(Actor Other)
{
    local int RecentHitIdx;

    RecentHitIdx = RecentUntouchEvents.Find('HitActor', Other;
    if((RecentHitIdx == -1) || (WorldInfo.TimeSeconds - RecentUntouchEvents[RecentHitIdx].HitTime) > ThrottleTime)
    {
        super.CausePainTo(Other);
    }
}

simulated event UnTouch(Actor Other)
{
    local int RecentHitIdx;

    super(Actor).UnTouch(Other);
    RecentHitIdx = RecentUntouchEvents.Find('HitActor', Other;
    if(RecentHitIdx == -1)
    {
        RecentUntouchEvents.Insert(0, 1;
        RecentUntouchEvents[RecentUntouchEvents.Length - 1].HitActor = Other;
        RecentUntouchEvents[RecentUntouchEvents.Length - 1].HitTime = WorldInfo.TimeSeconds;        
    }
    else
    {
        RecentUntouchEvents[RecentHitIdx].HitTime = WorldInfo.TimeSeconds;
    }
}

simulated event Tick(float DeltaTime)
{
    local int I;

    super(Actor).Tick(DeltaTime);
    I = RecentUntouchEvents.Length - 1;
    J0x2A:

    if(I >= 0)
    {
        if((WorldInfo.TimeSeconds - RecentUntouchEvents[I].HitTime) > ThrottleTime)
        {
            RecentUntouchEvents.Remove(I, 1;
        }
        -- I;
        goto J0x2A;
    }
}

defaultproperties
{
    ThrottleTime=0.01
    begin object name=BrushComponent0 class=BrushComponent
        ReplacementPrimitive=none
    object end
    // Reference: BrushComponent'Default__KFPhysicsVolume.BrushComponent0'
    BrushComponent=BrushComponent0
    begin object name=BrushComponent0 class=BrushComponent
        ReplacementPrimitive=none
    object end
    // Reference: BrushComponent'Default__KFPhysicsVolume.BrushComponent0'
    Components(0)=BrushComponent0
    begin object name=BrushComponent0 class=BrushComponent
        ReplacementPrimitive=none
    object end
    // Reference: BrushComponent'Default__KFPhysicsVolume.BrushComponent0'
    CollisionComponent=BrushComponent0
}