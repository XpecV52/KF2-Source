/*******************************************************************************
 * KFSM_BloatKingSubspawn_Explode generated by Eliot.UELib using UE Explorer.
 * Eliot.UELib ? 2009-2022 Eliot van Uytfanghe. All rights reserved.
 * http://eliotvu.com
 *
 * All rights belong to their respective owners.
 *******************************************************************************/
class KFSM_BloatKingSubspawn_Explode extends KFSM_PlaySingleAnim;

var float AnimLength;
var float AnimTicked;

function Tick(float DeltaTime)
{
    local KFPawn_Monster OwnerMonster;

    super(KFSpecialMove).Tick(DeltaTime);
    if(AnimLength > float(0))
    {
        AnimTicked += DeltaTime;
        AnimTicked = FClamp(AnimTicked, 0, AnimLength);
        OwnerMonster = KFPawn_Monster(KFPOwner);
        if(OwnerMonster != none)
        {
            OwnerMonster.RepInflateMatParam = byte(Max(OwnerMonster.RepInflateMatParam, FloatToByte(AnimTicked / AnimLength)));
            OwnerMonster.HandleDamageInflation();
        }
    }
}

function SpecialMoveStarted(bool bForced, name PrevMove)
{
    super.SpecialMoveStarted(bForced, PrevMove);
    AnimLength = KFPOwner.Mesh.GetAnimLength(AnimName);
}

function SpecialMoveEnded(name PrevMove, name NextMove)
{
    super.SpecialMoveEnded(PrevMove, NextMove);
    if(KFPawn_ZedBloatKingSubspawn(KFPOwner) != none)
    {
        KFPawn_ZedBloatKingSubspawn(KFPOwner).DelayExplode();
    }
}

defaultproperties
{
    AnimName=Atk_Explode
    bDisableMovement=true
    bLockPawnRotation=true
    bDisableTurnInPlace=true
    Handle=KFSM_BloatKingSubspawn_Explode
}