/*******************************************************************************
 * KFOutbreakEvent_Endless generated by Eliot.UELib using UE Explorer.
 * Eliot.UELib ? 2009-2022 Eliot van Uytfanghe. All rights reserved.
 * http://eliotvu.com
 *
 * All rights belong to their respective owners.
 *******************************************************************************/
class KFOutbreakEvent_Endless extends KFOutbreakEvent within KFGameInfo;

function OnScoreKill(Pawn KilledPawn)
{
    local StatAdjustments ToAdjust;

    foreach ActiveEvent.ZedsToAdjust(ToAdjust,)
    {
        if(ClassIsChildOf(KilledPawn.Class, ToAdjust.ClassToAdjust))
        {
            if(ToAdjust.bExplosiveDeath && ToAdjust.ExplosionTemplate != none)
            {
                if((KFPawn(KilledPawn) != none) && !KFPawn(KilledPawn).WeeklyShouldExplodeOnDeath())
                {                    
                    return;
                }
                KFGameInfo_Endless(Outer).DoDeathExplosion(KilledPawn, ToAdjust.ExplosionTemplate, ToAdjust.ExplosionIgnoreClass);
            }
        }        
    }    
}

function AdjustMonsterDefaults(out KFPawn_Monster P)
{
    local StatAdjustments ToAdjust;
    local array<StatAdjustments> ZedsToAdjust;

    super.AdjustMonsterDefaults(P);
    if(P == none)
    {
        return;
    }
    ZedsToAdjust = KFGameInfo_Endless(Outer).EndlessDifficulty.GetZedsToAdjust();
    foreach ZedsToAdjust(ToAdjust,)
    {
        if(ClassIsChildOf(P.Class, ToAdjust.ClassToAdjust))
        {
            P.Health *= ToAdjust.HealthScale;
            P.HealthMax *= ToAdjust.HealthScale;
            P.HitZones[0].GoreHealth *= ToAdjust.HeadHealthScale;
            P.HitZones[0].MaxGoreHealth = P.HitZones[0].GoreHealth;
            P.SetShieldScale(ToAdjust.ShieldScale);
        }        
    }    
}

function AdjustScoreDamage(Controller InstigatedBy, Pawn DamagedPawn, class<DamageType> DamageType)
{
    super.AdjustScoreDamage(InstigatedBy, DamagedPawn, DamageType);
    if(ActiveEvent.bUseBeefcakeRules)
    {
        if(InstigatedBy != none)
        {
            AdjustForBeefcakeRules(InstigatedBy.Pawn);
        }
        if((DamagedPawn != none) && DamageType == Class'KFDT_Toxic_PlayerCrawlerSuicide')
        {
            AdjustForBeefcakeRules(DamagedPawn, 3);
        }
    }
}

static function int GetOutbreakId(int SetEventsIndex)
{
    if((SetEventsIndex < 0) || SetEventsIndex >= default.SetEvents.Length)
    {
        return -1;
    }
    return default.SetEvents[SetEventsIndex].WeeklyOutbreakId;
}

defaultproperties
{
    SetEvents=/* Array type was not detected. */
}