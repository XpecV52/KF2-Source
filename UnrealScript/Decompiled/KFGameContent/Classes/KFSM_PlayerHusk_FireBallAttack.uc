/*******************************************************************************
 * KFSM_PlayerHusk_FireBallAttack generated by Eliot.UELib using UE Explorer.
 * Eliot.UELib ? 2009-2022 Eliot van Uytfanghe. All rights reserved.
 * http://eliotvu.com
 *
 * All rights belong to their respective owners.
 *******************************************************************************/
class KFSM_PlayerHusk_FireBallAttack extends KFSM_PlaySingleAnim;

var bool bReadyToFire;
var name WindUpAnimName;
var name FireHeldAnimName;

function SpecialMoveStarted(bool bForced, name PrevMove)
{
    super.SpecialMoveStarted(bForced, PrevMove);
    bReadyToFire = false;
    PlayWindUpAnimation();
}

function PlayAnimation();

function PlayWindUpAnimation()
{
    bUseRootMotion = true;
    KFPOwner.Mesh.RootMotionMode = 3;
    KFPOwner.BodyStanceNodes[0].SetRootBoneAxisOption(2, 2, 2);
    AnimStance = 0;
    PlaySpecialMoveAnim(WindUpAnimName, 0, BlendInTime, BlendOutTime, 1);
}

function PlayFireHeldAnimation()
{
    bReadyToFire = true;
    PlaySpecialMoveAnim(FireHeldAnimName, 0, BlendInTime, BlendOutTime, 1, true);
}

function PlayFireAnimation()
{
    bReadyToFire = false;
    bPendingStopFire = false;
    PlaySpecialMoveAnim(AnimName, 0, BlendInTime, BlendOutTime, 1, false);
}

function AnimEndNotify(AnimNodeSequence SeqNode, float PlayedTime, float ExcessTime)
{
    switch(SeqNode.AnimSeqName)
    {
        case WindUpAnimName:
            if(bPendingStopFire)
            {
                PlayFireAnimation();                
            }
            else
            {
                PlayFireHeldAnimation();
            }
            break;
        case AnimName:
            KFPOwner.EndSpecialMove();
            break;
        default:
            break;
    }
}

function SpecialMoveFlagsUpdated()
{
    if(KFPOwner.SpecialMoveFlags == 254)
    {
        bPendingStopFire = true;
        if(bReadyToFire)
        {
            PlayFireAnimation();
        }        
    }
    else
    {
        if(KFPOwner.SpecialMoveFlags == 253)
        {
            bPendingStopFire = false;            
        }
        else
        {
            super(GameSpecialMove).SpecialMoveFlagsUpdated();
        }
    }
}

function SpecialMoveButtonRetriggered()
{
    KFPOwner.DoSpecialMove(KFPOwner.SpecialMove, true,, 253);
    if((KFPOwner.Role < ROLE_Authority) && KFPOwner.IsLocallyControlled())
    {
        KFPOwner.ServerDoSpecialMove(KFPOwner.SpecialMove, true,, 253);
    }
}

function SpecialMoveButtonReleased()
{
    KFPOwner.DoSpecialMove(KFPOwner.SpecialMove, true,, 254);
    if((KFPOwner.Role < ROLE_Authority) && KFPOwner.IsLocallyControlled())
    {
        KFPOwner.ServerDoSpecialMove(KFPOwner.SpecialMove, true,, 254);
    }
}

defaultproperties
{
    WindUpAnimName=Player_Shoot_Start
    FireHeldAnimName=Player_Shoot_Loop
    AnimName=Player_Shoot_End
    bCanBeInterrupted=true
    bUseCustomThirdPersonViewOffset=true
    bDisableMovement=true
    bDisableSteering=false
    CustomThirdPersonViewOffset=(OffsetHigh=(X=-135,Y=75,Z=40),OffsetMid=(X=-120,Y=60,Z=0),OffsetLow=(X=-180,Y=75,Z=50))
    ViewOffsetInterpTime=0.3
    CustomCameraFOV=60
    CameraFOVTransitionTime=0.4
    Handle=KFSM_PlayerHusk_FireBallAttack
}