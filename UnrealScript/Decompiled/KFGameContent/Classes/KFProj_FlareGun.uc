/*******************************************************************************
 * KFProj_FlareGun generated by Eliot.UELib using UE Explorer.
 * Eliot.UELib ? 2009-2022 Eliot van Uytfanghe. All rights reserved.
 * http://eliotvu.com
 *
 * All rights belong to their respective owners.
 *******************************************************************************/
class KFProj_FlareGun extends KFProj_Bullet
    hidecategories(Navigation);

var float FlameDisperalDelay;
var Vector LastHitNormal;
var float ResidualFlameChance;

simulated function SpawnFlightEffects()
{
    super(KFProjectile).SpawnFlightEffects();
    if((WorldInfo.NetMode != NM_DedicatedServer) && WorldInfo.GetDetailMode() > 0)
    {
        SetTimer(FlameDisperalDelay, false, 'MidFlightFXTimer');
    }
}

simulated function MidFlightFXTimer()
{
    if(ProjEffects != none)
    {
        ProjEffects.SetFloatParameter('Spread', 1);
    }
}

protected simulated function StopFlightEffects()
{
    super(KFProjectile).StopFlightEffects();
    ClearTimer('MidFlightFXTimer');
}

simulated function ProcessTouch(Actor Other, Vector HitLocation, Vector HitNormal)
{
    LastHitNormal = HitNormal;
    super.ProcessTouch(Other, HitLocation, HitNormal);
}

simulated function TriggerExplosion(Vector HitLocation, Vector HitNormal, Actor HitActor)
{
    LastHitNormal = HitNormal;
    super.TriggerExplosion(HitLocation, HitNormal, HitActor);
}

protected simulated function StopSimulating()
{
    local Vector FlameSpawnVel;

    if(((Role == ROLE_Authority) && Physics == 2) && FRand() < ResidualFlameChance)
    {
        FlameSpawnVel = 0.25 * (CalculateResidualFlameVelocity(LastHitNormal, Normal(Velocity), VSize(Velocity)));
        SpawnResidualFlame(Class'KFProj_FlareGunSplash', Location + (LastHitNormal * 10), FlameSpawnVel);
    }
    super(KFProjectile).StopSimulating();
}

defaultproperties
{
    FlameDisperalDelay=0.25
    ResidualFlameChance=0.33
    bAmbientSoundZedTimeOnly=false
    bWarnAIWhenFired=true
    ProjFlightLightPriority=LightPoolPriority.LPP_High
    GravityScale=0.05
    TerminalVelocity=5000
    ProjFlightTemplate=ParticleSystem'WEP_Flaregun_EMIT.FX_Flaregun_Projectile_01'
    begin object name=PointLight0 class=PointLightComponent
        Radius=350
        FalloffExponent=3
        Brightness=1.5
        LightColor=(B=100,G=160,R=250,A=255)
        CastShadows=false
        CastStaticShadows=false
        CastDynamicShadows=false
        bCastPerObjectShadows=false
        LightingChannels=(Outdoor=true)
    object end
    // Reference: PointLightComponent'Default__KFProj_FlareGun.PointLight0'
    ProjFlightLight=PointLight0
    AmbientSoundPlayEvent=AkEvent'WW_WEP_Flare_Gun.Play_WEP_Flare_Gun_Whistle'
    AmbientSoundStopEvent=AkEvent'WW_WEP_Flare_Gun.Stop_WEP_Flare_Gun_Whistle'
    AmbientComponent=AkComponent'Default__KFProj_FlareGun.AmbientAkSoundComponent'
    ImpactEffects=KFImpactEffectInfo'WEP_FlareGun_ARCH.Wep_Flaregun_bullet_impact'
    Speed=5000
    MaxSpeed=5000
    begin object name=CollisionCylinder class=CylinderComponent
        ReplacementPrimitive=none
    object end
    // Reference: CylinderComponent'Default__KFProj_FlareGun.CollisionCylinder'
    CylinderComponent=CollisionCylinder
    begin object name=CollisionCylinder class=CylinderComponent
        ReplacementPrimitive=none
    object end
    // Reference: CylinderComponent'Default__KFProj_FlareGun.CollisionCylinder'
    Components(0)=CollisionCylinder
    Components(1)=AkComponent'Default__KFProj_FlareGun.AmbientAkSoundComponent'
    Physics=EPhysics.PHYS_Falling
    begin object name=CollisionCylinder class=CylinderComponent
        ReplacementPrimitive=none
    object end
    // Reference: CylinderComponent'Default__KFProj_FlareGun.CollisionCylinder'
    CollisionComponent=CollisionCylinder
}