/*******************************************************************************
 * KFSeasonalEventStats_Xmas2018 generated by Eliot.UELib using UE Explorer.
 * Eliot.UELib ? 2009-2022 Eliot van Uytfanghe. All rights reserved.
 * http://eliotvu.com
 *
 * All rights belong to their respective owners.
 *******************************************************************************/
class KFSeasonalEventStats_Xmas2018 extends KFSeasonalEventStats within KFOnlineStatsWrite;

var private const transient int PerfectEscortsRequired;
var private const transient int ZedKillsRequired;
var private const transient int BossDeathsRequired;
var private transient int PerfectEscortCount;
var private transient int ZedKillsCount;

private final event Initialize(string MapName)
{
    local string CapsMapName;

    CapsMapName = Caps(MapName);
    bObjectiveIsValidForMap[0] = 0;
    bObjectiveIsValidForMap[1] = 0;
    bObjectiveIsValidForMap[2] = 1;
    bObjectiveIsValidForMap[3] = 1;
    bObjectiveIsValidForMap[4] = 0;
    if(CapsMapName == "KF-SANTASWORKSHOP")
    {
        bObjectiveIsValidForMap[0] = 1;
        bObjectiveIsValidForMap[4] = 1;        
    }
    else
    {
        if(CapsMapName == "KF-SHOPPINGSPREE")
        {
            bObjectiveIsValidForMap[1] = 1;
        }
    }
    SetSeasonalEventStatsMax(0, 0, ZedKillsRequired, BossDeathsRequired, 0);
}

private final event GrantEventItems()
{
    if((((Outer.IsEventObjectiveComplete(0) && Outer.IsEventObjectiveComplete(1)) && Outer.IsEventObjectiveComplete(2)) && Outer.IsEventObjectiveComplete(3)) && Outer.IsEventObjectiveComplete(4))
    {
        GrantEventItem(5378);
    }
}

private static final event bool AllowEventBossOverrideForMap(string MapName)
{
    local string CapsMapName;

    CapsMapName = Caps(MapName);
    if(CapsMapName == "KF-SANTASWORKSHOP")
    {
        return true;
    }
    return false;
}

simulated function OnMapObjectiveDeactivated(Actor ObjectiveInterfaceActor)
{
    if(bObjectiveIsValidForMap[0] != 0)
    {
        if((KFMapObjective_EscortPawns(ObjectiveInterfaceActor) != none) && KFMapObjective_EscortPawns(ObjectiveInterfaceActor).CompletionPct > 0.99)
        {
            if(++ PerfectEscortCount == PerfectEscortsRequired)
            {
                Outer.MyKFPC.FinishedSpecialEvent(4, 0);
            }
        }
    }
}

simulated function OnZedKilled(class<KFPawn_Monster> MonsterClass, int Difficulty, class<DamageType> DT)
{
    if(bObjectiveIsValidForMap[2] != 0)
    {
        IncrementSeasonalEventStat(2, 1);
        if(Outer.GetSeasonalEventStatValue(2) >= ZedKillsRequired)
        {
            Outer.MyKFPC.FinishedSpecialEvent(4, 2);
        }
    }
}

simulated event OnGameWon(class<GameInfo> GameClass, int Difficulty, int GameLength, bool bCoop)
{
    if(bObjectiveIsValidForMap[4] != 0)
    {
        if((GameClass == Class'KFGameInfo_Survival') && float(Difficulty) >= 1)
        {
            Outer.MyKFPC.FinishedSpecialEvent(4, 4);
        }        
    }
    else
    {
        if(bObjectiveIsValidForMap[1] != 0)
        {
            if(GameClass == Class'KFGameInfo_WeeklySurvival')
            {
                Outer.MyKFPC.FinishedSpecialEvent(4, 1);
            }
        }
    }
}

simulated function OnBossDied()
{
    if(bObjectiveIsValidForMap[3] != 0)
    {
        IncrementSeasonalEventStat(3, 1);
        if(Outer.GetSeasonalEventStatValue(3) >= BossDeathsRequired)
        {
            Outer.MyKFPC.FinishedSpecialEvent(4, 3);
        }
    }
}

defaultproperties
{
    PerfectEscortsRequired=3
    ZedKillsRequired=2500
    BossDeathsRequired=25
}