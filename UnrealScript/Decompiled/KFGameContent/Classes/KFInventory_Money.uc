/*******************************************************************************
 * KFInventory_Money generated by Eliot.UELib using UE Explorer.
 * Eliot.UELib ? 2009-2022 Eliot van Uytfanghe. All rights reserved.
 * http://eliotvu.com
 *
 * All rights belong to their respective owners.
 *******************************************************************************/
class KFInventory_Money extends Inventory
    hidecategories(Navigation);

var float NextDropCashMessageTime;
var float DropCashMessageDelay;

function DropFrom(Vector StartLocation, Vector StartVelocity)
{
    local KFDroppedPickup_Cash KFDP;
    local PlayerReplicationInfo PRI;
    local int Amount;

    if((DroppedPickupClass == none) || DroppedPickupMesh == none)
    {
        return;
    }
    PRI = Instigator.PlayerReplicationInfo;
    if((PRI != none) && PRI.Score > float(0))
    {
        Amount = Min(50, int(PRI.Score));
    }
    if(Amount <= 0)
    {
        return;
    }
    StartLocation.Z += (Instigator.BaseEyeHeight / float(2));
    KFDP = KFDroppedPickup_Cash(Spawn(DroppedPickupClass,,, StartLocation,,, true));
    if(KFDP == none)
    {
        PlayerController(Instigator.Controller).ReceiveLocalizedMessage(Class'KFLocalMessage_Game', 16);
        return;
    }
    KFDP.SetPhysics(2);
    KFDP.Inventory = self;
    KFDP.InventoryClass = Class;
    KFDP.Velocity = StartVelocity * 1.6;
    KFDP.Instigator = Instigator;
    KFDP.SetPickupMesh(DroppedPickupMesh);
    KFDP.SetPickupParticles(DroppedPickupParticles);
    KFDP.CashAmount = Amount;
    KFDP.TosserPRI = PRI;
    if(KFPlayerReplicationInfo(PRI) != none)
    {
        KFPlayerReplicationInfo(PRI).AddDosh(-Amount);
    }
    if(((Role == ROLE_Authority) && KFGameInfo(WorldInfo.Game) != none) && KFGameInfo(WorldInfo.Game).DialogManager != none)
    {
        KFGameInfo(WorldInfo.Game).DialogManager.PlayDoshTossDialog(KFPawn(Instigator));
    }
}

function bool DenyPickupQuery(class<Inventory> ItemClass, Actor Pickup)
{
    return false;
}

defaultproperties
{
    DropCashMessageDelay=5
    DroppedPickupClass=Class'KFGame.KFDroppedPickup_Cash'
    begin object name=PickupMesh0 class=SkeletalMeshComponent
        SkeletalMesh=SkeletalMesh'GP_Mesh.dosh_SM'
        PhysicsAsset=PhysicsAsset'GP_Mesh.dosh_SM_Physics'
        ReplacementPrimitive=none
        CastShadow=false
    object end
    // Reference: SkeletalMeshComponent'Default__KFInventory_Money.PickupMesh0'
    DroppedPickupMesh=PickupMesh0
    begin object name=Sprite class=SpriteComponent
        ReplacementPrimitive=none
    object end
    // Reference: SpriteComponent'Default__KFInventory_Money.Sprite'
    Components(0)=Sprite
}