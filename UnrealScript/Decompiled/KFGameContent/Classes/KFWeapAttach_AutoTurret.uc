/*******************************************************************************
 * KFWeapAttach_AutoTurret generated by Eliot.UELib using UE Explorer.
 * Eliot.UELib ? 2009-2022 Eliot van Uytfanghe. All rights reserved.
 * http://eliotvu.com
 *
 * All rights belong to their respective owners.
 *******************************************************************************/
class KFWeapAttach_AutoTurret extends KFWeapAttach_DualBase
    hidecategories(Navigation,Object,Movement,Attachment,Collision,Physics,Advanced,Debug,Mobile);

const ThrowAnim = 'Drone_Throw';
const CrouchThrowAnim = 'Drone_Throw_CH';
const DetonateAnim = 'Shoot';
const CrouchDetonateAnim = 'CH_Shoot';
const TransitionParamName = 'transition_full_to_empty';
const EmptyParamName = 'Blinking_0_off___1_on';

simulated function bool ThirdPersonFireEffects(Vector HitLocation, KFPawn P, byte ThirdPersonAnimRateByte)
{
    local float Duration;

    if(!ActorEffectIsRelevant(P, false, MaxFireEffectDistance))
    {
        return false;
    }
    DecodeThirdPersonAnimRate(ThirdPersonAnimRateByte);
    if(P.FiringMode == 0)
    {
        Duration = WeapMesh.GetAnimLength('Drone_Throw');
        WeapMesh.PlayAnim('Drone_Throw', Duration / ThirdPersonAnimRate,, true);
        SetTimer(0.75, false, 'UnHide');        
    }
    else
    {
        if(P.FiringMode == 5)
        {
            Duration = WeapMesh.GetAnimLength('Shoot');
            LeftWeapMesh.PlayAnim('Shoot', Duration / ThirdPersonAnimRate,, true);
        }
    }
    if(!P.IsDoingSpecialMove())
    {
        if(P.FiringMode == 0)
        {
            if(P.bIsCrouched)
            {
                P.PlayBodyAnim('Drone_Throw_CH', 4, ThirdPersonAnimRate, ShootBlendInTime, ShootBlendOutTime);                
            }
            else
            {
                P.PlayBodyAnim('Drone_Throw', 1, ThirdPersonAnimRate, ShootBlendInTime, ShootBlendOutTime);
            }            
        }
        else
        {
            if(P.FiringMode == 5)
            {
                if(P.bIsCrouched)
                {
                    P.PlayBodyAnim('CH_Shoot', 4, ThirdPersonAnimRate, ShootBlendInTime, ShootBlendOutTime);                    
                }
                else
                {
                    P.PlayBodyAnim('Shoot', 1, ThirdPersonAnimRate, ShootBlendInTime, ShootBlendOutTime);
                }
            }
        }
    }
    P.LastWeaponFireTime = -1;
    return true;
}

simulated function UnHide()
{
    if(WeapMesh != none)
    {
        WeapMesh.UnHideBoneByName('RW_Weapon');
    }
}

function OnSpecialEvent(int Arg)
{
    local float Value;

    Value = float(Arg - 1) / 100;
    if(Value >= float(0))
    {
        if((WeaponMIC == none) && LeftWeapMesh != none)
        {
            WeaponMIC = LeftWeapMesh.CreateAndSetMaterialInstanceConstant(2);
        }
        WeaponMIC.SetScalarParameterValue('transition_full_to_empty', 1 - Value);
        WeaponMIC.SetScalarParameterValue('Blinking_0_off___1_on', float(((Value == float(0)) ? 1 : 0)));
    }
}

defaultproperties
{
    begin object name=SkeletalMeshComponent1 class=SkeletalMeshComponent
        Animations=AnimNodeSequence'Default__KFWeapAttach_AutoTurret.SkeletalMeshComponent1.MeshSequenceA'
        ReplacementPrimitive=none
    object end
    // Reference: SkeletalMeshComponent'Default__KFWeapAttach_AutoTurret.SkeletalMeshComponent1'
    LeftWeapMesh=SkeletalMeshComponent1
    begin object name=SkeletalMeshComponent0 class=SkeletalMeshComponent
        Animations=AnimNodeSequence'Default__KFWeapAttach_AutoTurret.SkeletalMeshComponent0.MeshSequenceA'
        ReplacementPrimitive=none
    object end
    // Reference: SkeletalMeshComponent'Default__KFWeapAttach_AutoTurret.SkeletalMeshComponent0'
    WeapMesh=SkeletalMeshComponent0
}