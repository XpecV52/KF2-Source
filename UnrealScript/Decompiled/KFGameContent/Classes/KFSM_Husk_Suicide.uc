/*******************************************************************************
 * KFSM_Husk_Suicide generated by Eliot.UELib using UE Explorer.
 * Eliot.UELib ? 2009-2022 Eliot van Uytfanghe. All rights reserved.
 * http://eliotvu.com
 *
 * All rights belong to their respective owners.
 *******************************************************************************/
class KFSM_Husk_Suicide extends KFSM_PlaySingleAnim;

var protected bool bSuicideAnimFinished;

protected function bool InternalCanDoSpecialMove()
{
    if(KFPOwner.IsHumanControlled())
    {
        return KFPOwner.IsAliveAndWell();
    }
    if(((AIOwner == none) || AIOwner.MyKFPawn == none) || AIOwner.Enemy == none)
    {
        return false;
    }
    if(AIOwner.MyKFPawn.IsImpaired())
    {
        return false;
    }
    return super(KFSpecialMove).InternalCanDoSpecialMove();
}

function SpecialMoveStarted(bool bForced, name PrevMove)
{
    bSuicideAnimFinished = false;
    super.SpecialMoveStarted(bForced, PrevMove);
}

function AnimEndNotify(AnimNodeSequence SeqNode, float PlayedTime, float ExcessTime)
{
    bSuicideAnimFinished = true;
    super.AnimEndNotify(SeqNode, PlayedTime, ExcessTime);
}

simulated function SpecialMoveEnded(name PrevMove, name NextMove)
{
    if(KFPOwner.bLogSpecialMove)
    {
        LogInternal(string(self) $ " SpecialMoveEnded");
    }
    if(bSuicideAnimFinished && !bPendingStopFire)
    {
        KFPawn_ZedHusk(PawnOwner).TriggerExplosion();
    }
    super.SpecialMoveEnded(PrevMove, NextMove);
}

defaultproperties
{
    AnimName=Atk_Suicide_V1
    bUseRootMotion=true
    bPawnRotationLocked=true
    Handle=KFSM_HuskSuicide
}