/*******************************************************************************
 * KFProj_Bullet_MatriarchTeslaBlast generated by Eliot.UELib using UE Explorer.
 * Eliot.UELib ? 2009-2022 Eliot van Uytfanghe. All rights reserved.
 * http://eliotvu.com
 *
 * All rights belong to their respective owners.
 *******************************************************************************/
class KFProj_Bullet_MatriarchTeslaBlast extends KFProj_Bullet
    hidecategories(Navigation);

var ParticleSystem BeamPS;
var ParticleSystem BeamHitPS;
var export editinline transient ParticleSystemComponent BeamPSC;
var export editinline transient ParticleSystemComponent BeamHitPSC;
var repnotify transient Pawn SourcePawn;
var repnotify transient Pawn TargetPawn;

replication
{
     if(bNetInitial)
        SourcePawn, TargetPawn;
}

simulated event ReplicatedEvent(name VarName)
{
    switch(VarName)
    {
        case 'SourcePawn':
        case 'TargetPawn':
            ActivateVFX();
            break;
        default:
            super(KFProjectile).ReplicatedEvent(VarName);
            break;
    }
}

simulated event PostBeginPlay()
{
    super(KFProjectile).PostBeginPlay();
    StopSimulating();
    SetTickIsDisabled(true);
}

simulated function ActivateVFX()
{
    local Vector TargetLocation;

    if(BeamPSC == none)
    {
        if(KFPawn_ZedMatriarch(SourcePawn) != none)
        {
            BeamPSC = WorldInfo.MyEmitterPool.SpawnEmitterMeshAttachment(BeamPS, SourcePawn.Mesh, 'Hand_FX_End_L', true);            
        }
        else
        {
            BeamPSC = WorldInfo.MyEmitterPool.SpawnEmitter(BeamPS, Location,, SourcePawn);
        }
        TargetLocation = TargetPawn.Mesh.GetBoneLocation(Class'KFPawn_ZedMatriarch'.default.GunTargetBoneName);
        BeamHitPSC = WorldInfo.MyEmitterPool.SpawnEmitter(BeamHitPS, TargetLocation,, TargetPawn);
        BeamPSC.SetBeamTargetPoint(0, TargetLocation, 0);
        SetTickIsDisabled(false);
    }
}

simulated function DeactivateVFX()
{
    if(BeamPSC != none)
    {
        BeamPSC.DeactivateSystem();
        BeamPSC = none;
    }
    if(BeamHitPSC != none)
    {
        BeamHitPSC.DeactivateSystem();
        BeamHitPSC = none;
    }
}

simulated function Tick(float DeltaTime)
{
    super(Actor).Tick(DeltaTime);
    if(BeamPSC != none)
    {
        BeamPSC.SetBeamTargetPoint(0, TargetPawn.Mesh.GetBoneLocation(Class'KFPawn_ZedMatriarch'.default.GunTargetBoneName), 0);
    }
}

simulated function Destroyed()
{
    super(KFProjectile).Destroyed();
    DeactivateVFX();
}

defaultproperties
{
    BeamPS=ParticleSystem'ZED_Matriarch_EMIT.FX_Teslablast_Beam_01'
    BeamHitPS=ParticleSystem'ZED_Matriarch_EMIT.FX_Tesla_Blast_Impact_01'
    bUseClientSideHitDetection=false
    ProjEffectsFadeOutDuration=0.5
    AmbientComponent=AkComponent'Default__KFProj_Bullet_MatriarchTeslaBlast.AmbientAkSoundComponent'
    ImpactEffects=none
    Speed=0
    MaxSpeed=0
    bRotationFollowsVelocity=false
    begin object name=CollisionCylinder class=CylinderComponent
        ReplacementPrimitive=none
    object end
    // Reference: CylinderComponent'Default__KFProj_Bullet_MatriarchTeslaBlast.CollisionCylinder'
    CylinderComponent=CollisionCylinder
    begin object name=CollisionCylinder class=CylinderComponent
        ReplacementPrimitive=none
    object end
    // Reference: CylinderComponent'Default__KFProj_Bullet_MatriarchTeslaBlast.CollisionCylinder'
    Components(0)=CollisionCylinder
    Components(1)=AkComponent'Default__KFProj_Bullet_MatriarchTeslaBlast.AmbientAkSoundComponent'
    begin object name=CollisionCylinder class=CylinderComponent
        ReplacementPrimitive=none
    object end
    // Reference: CylinderComponent'Default__KFProj_Bullet_MatriarchTeslaBlast.CollisionCylinder'
    CollisionComponent=CollisionCylinder
}